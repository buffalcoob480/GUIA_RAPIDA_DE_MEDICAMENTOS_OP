<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guía Farmacológica y Clínica - Centro de Salud Colonia Azteca</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* --- ESTILOS PARA SCROLLBAR --- */
        body::-webkit-scrollbar { width: 8px; }
        body::-webkit-scrollbar-track { background: #f1f5f9; }
        body::-webkit-scrollbar-thumb { background-color: #94a3b8; border-radius: 10px; border: 2px solid #f1f5f9; }
        .dark body::-webkit-scrollbar-track { background: #0f172a; }
        .dark body::-webkit-scrollbar-thumb { background-color: #475569; border-color: #0f172a; }

        /* --- SECCIÓN DE CONTROLES Y DESPLEGABLES --- */
        .filter-controls { display: flex; gap: 0.75rem; flex-wrap: wrap; justify-content: center; }
        .dropdown-wrapper { position: relative; }
        .dropdown-btn { display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1.5rem; background-color: white; border: 1px solid #cbd5e1; border-radius: 9999px; font-weight: 500; color: #334155; transition: all 0.2s ease-in-out; cursor: pointer; }
        .dropdown-btn:hover, .dropdown-btn:focus-visible { background-color: #f8fafc; border-color: #94a3b8; outline: none; box-shadow: 0 0 0 2px #e0f2fe; }
        .dropdown-btn.active { background-color: #eff6ff; border-color: #2563eb; color: #2563eb; }
        .dropdown-btn svg { transition: transform 0.2s; }
        .dropdown-btn.active[aria-expanded="true"] svg { transform: rotate(180deg); }
        .dropdown-panel { position: absolute; top: calc(100% + 0.5rem); left: 0; background-color: white; border-radius: 0.75rem; box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); border: 1px solid #e2e8f0; width: 280px; padding: 0.5rem; z-index: 50; max-height: 400px; overflow-y: auto; opacity: 0; transform: translateY(-10px) scale(0.98); visibility: hidden; transition: all 0.2s ease-in-out; }
        .dropdown-panel.is-open { opacity: 1; transform: translateY(0) scale(1); visibility: visible; }

        /* --- FILTROS AVANZADOS Y PERFIL PACIENTE --- */
        .profile-btn, .adv-filter-btn { padding: 0.5rem 1rem; border: 1px solid #cbd5e1; border-radius: 9999px; font-size: 0.875rem; cursor: pointer; transition: all 0.2s ease; }
        .profile-btn.active { background-color: #2563eb; color: white; border-color: #2563eb; }
        #advanced-filter-panel { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; }
        .adv-filter-group h4 { font-weight: 600; margin-bottom: 0.5rem; }
        .adv-filter-group label { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem; }
        .dark .profile-btn { border-color: #475569; color: #cbd5e1; }
        .dark .profile-btn:hover { background-color: #334155; }
        .dark .profile-btn.active { background-color: #3b82f6; color: white; border-color: #3b82f6; }

        /* --- ESTILOS DE VISTAS Y CONTENIDO --- */
        #medication-section, #themes-section, #interaction-section { transition: opacity 0.4s ease, transform 0.4s ease; }
        .hidden { display: none !important; }

        .filter-btn, .theme-btn { width: 100%; text-align: left; padding: 0.5rem 1rem; font-size: 0.875rem; border-radius: 0.375rem; transition: background-color 0.2s, color 0.2s; cursor: pointer; border: none; background: none; }
        .filter-btn:hover, .theme-btn:hover { background-color: #f1f5f9; }
        .filter-btn:focus-visible, .theme-btn:focus-visible { background-color: #e2e8f0; outline: none; }
        .filter-btn.active, .theme-btn.active { background-color: #2563eb; color: white; font-weight: 600; }
        .filter-btn.active:hover, .theme-btn.active:hover { background-color: #1d4ed8; }

        /* --- SKELETON LOADER --- */
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
        .skeleton-card { background-color: #e2e8f0; border-radius: 0.75rem; height: 232px; animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .dark .skeleton-card { background-color: #334155; }

        /* --- TARJETAS DE MEDICAMENTOS --- */
        .medication-card { transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .medication-card:hover { transform: translateY(-4px); box-shadow: 0 10px 20px rgba(0,0,0,0.08); }
        .favorite-btn-card { -webkit-text-stroke: 1.5px #a1a1aa; color: transparent; }
        .favorite-btn-card.is-favorite, #modalFavButton.is-favorite { color: #facc15; -webkit-text-stroke: 1.5px #ca8a04; }
        .card-img.lazy { background-color: #e2e8f0; } /* Placeholder color */
        .dark .card-img.lazy { background-color: #334155; }

        /* --- CAJAS DE INFO Y CALCULADORA --- */
        .info-box-success, .info-box-danger, .info-box-warning, .info-box-info { display: flex; gap: 0.75rem; align-items: flex-start; padding: 1rem; border-radius: 0.5rem; border: 1px solid; transition: all 0.3s ease; }
        .info-box-highlight { transform: scale(1.03); box-shadow: 0 0 15px rgba(59, 130, 246, 0.4); }
        .info-box-success { background-color: #f0fdf4; border-color: #bbf7d0; color: #166534; }
        .info-box-danger { background-color: #fef2f2; border-color: #fecaca; color: #991b1b; }
        .info-box-warning { background-color: #fffbeb; border-color: #fde68a; color: #b45309; }
        .info-box-info { background-color: #eff6ff; border-color: #bfdbfe; color: #1e40af; }

        .info-box-age, .info-box-pregnancy, .info-box-lactation { padding: 0.75rem; border-radius: 0.5rem; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 0.25rem; border: 1px solid; }
        .info-box-age { background-color: #fafafa; border-color: #e5e5e5; color: #3f3f46; }
        .info-box-pregnancy { background-color: #fef2f2; border-color: #fecaca; color: #991b1b; }
        .info-box-lactation { background-color: #eff6ff; border-color: #bfdbfe; color: #1e40af; }

        .calculator-card { background-color: #f8fafc; border: 1px solid #e2e8f0; border-radius: 0.75rem; overflow: hidden; }
        .calculator-header { display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1rem; background-color: #e0f2fe; color: #0c4a6e; }
        .calculator-body { padding: 1rem; display: flex; flex-direction: column; gap: 0.75rem; }
        .calculator-result { padding: 1rem; border-top: 1px solid #e2e8f0; display: flex; flex-direction: column; gap: 0.5rem; }
        .result-item { display: flex; align-items: center; gap: 0.5rem; }
        .copy-btn { display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; margin-top: 0.75rem; padding: 0.5rem 1rem; background-color: #dbeafe; color: #1e40af; font-weight: 500; border-radius: 0.375rem; transition: background-color 0.2s; }
        .copy-btn:hover { background-color: #bfdbfe; }

        /* --- ESTILOS DE PROSE (TEMAS CLÍNICOS) --- */
        .prose { background-color: white; padding: 2rem; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); }
        .prose h2 { font-size: 1.875rem; font-weight: 700; border-bottom: 1px solid #e2e8f0; padding-bottom: 0.5rem; margin-bottom: 1.5rem; color: #1e293b;}
        .prose h3 { font-size: 1.5rem; font-weight: 600; margin-top: 2em; margin-bottom: 1em; color: #1e293b;}
        .prose h4 { font-size: 1.125rem; font-weight: 600; margin-top: 1.5em; margin-bottom: 0.5em; color: #334155;}
        .prose p, .prose li { font-size: 1rem; line-height: 1.7; color: #334155; }
        .prose strong { font-weight: 600; color: #1e293b; }
        .prose ul { list-style-type: disc; padding-left: 1.5rem; margin-top: 1em; margin-bottom: 1em; }
        .prose a { color: #2563eb; text-decoration: none; border-bottom: 2px solid #93c5fd; transition: all 0.2s; cursor: pointer;}
        .prose a:hover { background-color: #dbeafe; border-bottom-color: #3b82f6; }
        .bibliografia { margin-top: 2.5rem; padding-top: 1rem; border-top: 1px solid #e2e8f0; font-size: 0.875rem; color: #64748b; }
        .bibliografia h4 { margin-bottom: 0.5rem; }

        /* --- VERIFICADOR DE INTERACCIONES --- */
        .interaction-checker-container { background-color: white; border-radius: 0.75rem; padding: 1.5rem; sm:padding: 2rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); }
        .interaction-header h2 { font-size: 1.875rem; font-weight: 700; color: #1e293b; }
        .interaction-header p { color: #475569; margin-top: 0.5rem; }
        .interaction-body { display: grid; grid-template-columns: 1fr; gap: 2rem; margin-top: 1.5rem; }
        @media (min-width: 768px) { .interaction-body { grid-template-columns: 1fr 2fr; } }
        .interaction-selection-controls { margin-bottom: 1rem; }
        .interaction-search-bar { width: 100%; padding: 0.5rem 1rem; border: 1px solid #cbd5e1; border-radius: 0.375rem; margin-bottom: 0.5rem; }
        .interaction-selection-info { display: flex; justify-content: space-between; align-items: center; font-size: 0.875rem; color: #64748b; }
        .clear-selection-btn { color: #2563eb; cursor: pointer; background: none; border: none; padding: 0; font-weight: 500;}
        .clear-selection-btn:hover { text-decoration: underline; }
        .med-selection-list { max-height: 400px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 0.5rem; padding: 0.5rem; }
        .interaction-med-btn { display: block; width: 100%; text-align: left; padding: 0.5rem 1rem; border-radius: 0.375rem; transition: background-color 0.2s; cursor: pointer; background: none; border: none; }
        .interaction-med-btn:hover { background-color: #f1f5f9; }
        .interaction-med-btn.selected { background-color: #eff6ff; color: #2563eb; font-weight: 600; }
        .interaction-results { border: 1px solid #e2e8f0; border-radius: 0.5rem; padding: 1.5rem; }
        .interaction-item { margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid #e2e8f0; }
        .interaction-item:last-child { border-bottom: none; margin-bottom: 0; }
        .interaction-item .level-critical { color: #dc2626; font-weight: 700;}
        .interaction-item .level-moderate { color: #f59e0b; font-weight: 700;}

        /* --- VENTANA MODAL --- */
        #medicationModal.hidden #modal-content-wrapper { opacity: 0; transform: scale(0.95); }
        #medicationModal #modal-content-wrapper { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); opacity: 1; transform: scale(1); }

        /* --- MODO OSCURO (ALFREDO) --- */
        body.dark { background-color: #0f172a !important; color: #f1f5f9 !important; }
        .dark .text-slate-500, .dark .text-slate-600, .dark .text-slate-700, .dark .text-slate-800, .dark .text-slate-900 { color: #cbd5e1 !important; }
        .dark #families-btn-text, .dark .text-slate-400 { color: #cbd5e1 !important; }
        .dark .bg-slate-50 { background-color: #020617 !important; }
        .dark .bg-slate-100 { background-color: #0f172a !important; }
        .dark .bg-white { background-color: #1e293b !important; }
        .dark .border-t, .dark .border-b, .dark .border-slate-200, .dark .border-slate-300, .dark .border-slate-400 { border-color: #334155 !important; }
        .dark .dropdown-btn { background-color: #334155; border-color: #475569; color: #f1f5f9;}
        .dark .dropdown-btn:hover, .dark .dropdown-btn:focus-visible { background-color: #475569; border-color: #64748b; }
        .dark .dropdown-panel { background-color: #1e293b; border-color: #334155;}
        .dark .filter-btn:hover, .dark .theme-btn:hover { background-color: #334155; }
        .dark .filter-btn.active, .dark .theme-btn.active { background-color: #3b82f6; color: white; }
        .dark .filter-btn.active:hover, .dark .theme-btn.active:hover { background-color: #2563eb; }
        .dark .medication-card:hover { box-shadow: 0 10px 20px rgba(0,0,0,0.25); }

        .dark .info-box-success { background-color: #143621; border-color: #22c55e; color: #dcfce7; }
        .dark .info-box-danger { background-color: #450a0a; border-color: #ef4444; color: #fee2e2; }
        .dark .info-box-warning { background-color: #422006; border-color: #f59e0b; color: #fef3c7; }
        .dark .info-box-info { background-color: #172554; border-color: #3b82f6; color: #dbeafe; }
        .dark .info-box-highlight { box-shadow: 0 0 15px rgba(96, 165, 250, 0.5); }


        .dark .info-box-age { background-color: #27272a; border-color: #52525b; color: #e4e4e7; }
        .dark .info-box-pregnancy { background-color: #450a0a; border-color: #ef4444; color: #fee2e2; }
        .dark .info-box-lactation { background-color: #172554; border-color: #3b82f6; color: #dbeafe; }

        .dark .calculator-card { background-color: #0f172a; border-color: #334155; }
        .dark .calculator-header { background-color: #1e293b; color: #dbeafe; }
        .dark .calculator-result { border-color: #334155; }
        .dark #patientWeight, .dark .interaction-search-bar, .dark .adv-filter-group input { background-color: #334155; border-color: #475569; color: #f1f5f9; }
        .dark .copy-btn { background-color: #1e40af; color: #dbeafe; }
        .dark .copy-btn:hover { background-color: #1e3a8a; }

        .dark .prose, .dark .interaction-checker-container { background-color: #1e293b; }
        .dark .prose h2, .dark .prose h3, .dark .prose strong, .dark .prose h4, .dark .interaction-header h2 { color: white; }
        .dark .prose p, .dark .prose li { color: #cbd5e1; } .dark .interaction-header p { color: #94a3b8; }
        .dark .prose a { color: #818cf8; border-bottom-color: #6366f1; } 
        .dark .prose a:hover { background-color: #312e81; border-bottom-color: #818cf8; }
        .dark .bibliografia, .dark .interaction-item { border-color: #334155; }
        .dark .interaction-results, .dark .med-selection-list { border-color: #334155; }
        .dark .interaction-med-btn:hover { background-color: #334155; }
        .dark .interaction-med-btn.selected { background-color: #3b82f6; color: white; }
        .dark .clear-selection-btn { color: #60a5fa; }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

<div class="fixed top-4 right-4 z-[60]">
    <button id="modoAlfredoToggle" class="px-4 py-2 bg-slate-900 text-white rounded-full shadow-lg hover:bg-slate-700 transition-transform hover:scale-105" aria-label="Cambiar a modo oscuro">
        Modo Alfredo
    </button>
</div>

<main class="main-content">
    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-10">
            <h1 class="text-3xl sm:text-5xl font-bold text-slate-900">Guía Farmacológica y Clínica</h1>
            <p class="text-lg text-slate-600 mt-2">Centro de Salud Colonia Azteca</p>
            <p class="text-sm text-slate-500 mt-4">Actualmente con <span id="med-count" class="font-bold text-slate-600">0</span> medicamentos en la base de datos.</p>
        </header>

        <section class="mb-8 p-4 bg-white/50 dark:bg-slate-900/50 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700">
            <div class="search-wrapper mb-4">
                <input id="searchBar" type="text" placeholder="Buscar por nombre, familia, uso..." aria-label="Buscar medicamento" class="w-full p-4 border border-slate-300 rounded-full shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" list="search-history">
                <datalist id="search-history"></datalist>
            </div>
            <nav class="filter-controls" aria-label="Filtros principales">
                <button id="favorites-btn" class="dropdown-btn"><span>★ Favoritos</span></button>
                <button id="interaction-checker-btn" class="dropdown-btn"><span>⇆ Interacciones</span></button>
                <div class="dropdown-wrapper">
                    <button id="families-dropdown-btn" class="dropdown-btn" aria-haspopup="true" aria-expanded="false">
                        <span id="families-btn-text">Familias</span>
                        <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                    </button>
                    <div id="families-dropdown-panel" class="dropdown-panel"><nav id="familyFilterContainer" aria-label="Filtros por familia"></nav></div>
                </div>
                <div class="dropdown-wrapper">
                    <button id="themes-dropdown-btn" class="dropdown-btn" aria-haspopup="true" aria-expanded="false">
                        <span>Temas</span>
                        <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                    </button>
                    <div id="themes-dropdown-panel" class="dropdown-panel"><nav id="themesFilterContainer" aria-label="Temas de interés"></nav></div>
                </div>
                <button id="advanced-filter-btn" class="dropdown-btn relative">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M5 4a1 1 0 00-2 0v7.268a2 2 0 000 3.464V16a1 1 0 102 0v-1.268a2 2 0 000-3.464V4zM11 4a1 1 0 10-2 0v1.268a2 2 0 000 3.464V16a1 1 0 102 0V8.732a2 2 0 000-3.464V4zM16 3a1 1 0 011 1v7.268a2 2 0 010 3.464V16a1 1 0 11-2 0v-1.268a2 2 0 010-3.464V4a1 1 0 011-1z" /></svg>
                    <span>Filtros Avanzados</span>
                    <span id="advanced-filter-count" class="hidden absolute -top-1 -right-1 bg-blue-600 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center"></span>
                </button>
            </nav>
        </section>
        
        <section id="patient-profile-section" class="mb-6 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg">
            <h3 class="font-bold text-center text-blue-800 dark:text-blue-300 mb-2">Perfil de Paciente (Opcional)</h3>
            <div id="patient-profile-controls" class="flex flex-wrap justify-center gap-2"></div>
        </section>

        <section id="advanced-filter-panel" class="hidden mb-6 p-4 bg-white dark:bg-slate-800 rounded-lg shadow-md border dark:border-slate-700"></section>

        <div id="view-container" class="mt-8">
            <section id="medication-section">
                <div id="skeleton-loader" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    <div class="skeleton-card"></div><div class="skeleton-card"></div><div class="skeleton-card"></div><div class="skeleton-card"></div>
                    <div class="skeleton-card"></div><div class="skeleton-card"></div><div class="skeleton-card"></div><div class="skeleton-card"></div>
                </div>
                <div id="medication-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 hidden"></div>
                <div id="no-results" class="text-center py-16 text-slate-500 text-xl hidden" role="status"><p>No se encontraron medicamentos.</p></div>
            </section>
            
            <section id="themes-section" class="hidden prose max-w-none"></section>
            <section id="interaction-section" class="hidden"></section>
        </div>
        <footer class="text-center p-4 mt-8 text-sm text-slate-500 border-t">
            <p>Información de referencia. Consulte siempre a un profesional de la salud.</p>
        </footer>
    </div>
</main>

<div id="medicationModal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div id="modal-content-wrapper" tabindex="-1" class="bg-white rounded-2xl shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col transform transition-all duration-300 scale-95 opacity-0"></div>
</div>

<div id="toast-notification" class="fixed bottom-5 right-5 bg-slate-900 text-white py-2 px-5 rounded-full shadow-lg opacity-0 translate-y-3 transition-all duration-300">
    <p id="toast-message"></p>
</div>

<template id="medication-card-template">
  <article class="medication-card bg-white rounded-xl shadow-md flex flex-col overflow-hidden relative">
    <div id="card-warning-icon" class="hidden absolute top-2 left-2 text-xl z-10" title="Información relevante para el perfil de paciente">⚠️</div>
    <button class="favorite-btn-card absolute top-2 right-2 text-2xl text-slate-300 hover:text-yellow-400 transition-colors z-10" aria-label="Añadir a favoritos">★</button>
    <div class="card-content-wrapper cursor-pointer">
        <img data-src="" src="https://placehold.co/400x200/e2e8f0/e2e8f0" alt="" class="card-img w-full h-32 object-cover lazy">
        <div class="p-5 flex flex-col flex-grow">
            <div>
                <h3 class="card-name font-bold text-lg text-slate-900"></h3><p class="card-presentation text-sm text-slate-600"></p>
            </div>
            <div class="mt-4 pt-4 border-t border-slate-200 text-xs flex-grow flex flex-col justify-end">
                <p class="card-family font-semibold text-blue-600"></p><p class="card-uses text-slate-500 mt-1"></p>
            </div>
        </div>
    </div>
  </article>
</template>

<script>
document.addEventListener('DOMContentLoaded', () => {

    const medicationData = [
    {
        "name": "Hialuronato / Oximetazolina",
        "presentation": "Solución Oftálmica 2mg/0.25mg por 10ml",
        "family": "Combinación (Lubricante Ocular + Descongestivo)",
        "simpleFamily": "Oftalmológicos",
        "uses": "Alivio de la irritación y enrojecimiento ocular.",
        "indications": "Ojo rojo, irritación por factores externos como polvo, humo o fatiga visual.",
        "dose_adult": "1-2 gotas en el ojo afectado cada 6-8 horas.",
        "dose_pediatric": "Uso no recomendado en niños pequeños sin supervisión médica.",
        "contraindications": "Hipersensibilidad, glaucoma de ángulo estrecho.",
        "minimumAge": "6 años",
        "pregnancy": "Categoría C (Según FDA)",
        "lactation": "Riesgo Bajo (Según e-lactancia.org)",
        "warnings": "No usar por más de 72 horas sin indicación médica para evitar efecto de rebote."
    },
    {
        "name": "Gabapentina",
        "presentation": "Cápsulas 300mg",
        "family": "Análogo de GABA (Anticonvulsivo)",
        "simpleFamily": "Anticonvulsivos",
        "uses": "Dolor neuropático, epilepsia.",
        "indications": "Neuralgia postherpética, terapia adyuvante en crisis parciales.",
        "dose_adult": "Inicial: 300 mg/día. Titular hasta 900-3600 mg/día en 3 dosis.",
        "dose_pediatric": "Niños 3-12 años: 10-15 mg/kg/día (inicial), titular hasta 25-35 mg/kg/día.",
        "contraindications": "Hipersensibilidad.",
        "minimumAge": "3 años",
        "pregnancy": "Categoría C (Según FDA)",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)",
        "renalDoseAdjust": { "enabled": true },
        "warnings": "La suspensión del tratamiento debe ser gradual."
    },
    {
        "name": "Multivitamínico Materno (SimiBaby)",
        "presentation": "30 Cápsulas",
        "family": "Suplemento Prenatal",
        "simpleFamily": "Vitaminas y Suplementos",
        "uses": "Suplemento vitamínico y mineral durante el embarazo y la lactancia.",
        "indications": "Prevención de deficiencias nutricionales en la etapa preconcepcional, embarazo y lactancia.",
        "dose_adult": "1 cápsula al día.",
        "dose_pediatric": "No aplica.",
        "contraindications": "Hipersensibilidad a alguno de los componentes.",
        "minimumAge": "N/A",
        "pregnancy": "Categoría A (Según FDA) - Recomendado",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Mometasona / Azelastina",
        "presentation": "Suspensión Nasal 50mcg/140mcg (150 dosis)",
        "family": "Combinación (Corticosteroide + Antihistamínico)",
        "simpleFamily": "Respiratorios",
        "uses": "Tratamiento de los síntomas de la rinitis alérgica.",
        "indications": "Rinitis alérgica estacional y perenne moderada a grave.",
        "dose_adult": "1 atomización en cada fosa nasal dos veces al día.",
        "dose_pediatric": "Niños >12 años: Misma dosis que adultos.",
        "contraindications": "Hipersensibilidad, infecciones nasales no tratadas.",
        "minimumAge": "12 años",
        "pregnancy": "Categoría C (Según FDA)",
        "lactation": "Riesgo Bajo (Según e-lactancia.org)"
    },
    {
        "name": "Ambroxol / Dextrometorfano",
        "presentation": "Tabletas 22.5mg/22.5mg",
        "family": "Combinación (Mucolítico + Antitusígeno)",
        "simpleFamily": "Respiratorios",
        "uses": "Alivio de la tos seca y con flemas.",
        "indications": "Tos irritativa asociada a procesos bronquiales con producción de moco.",
        "dose_adult": "1 tableta cada 8 horas.",
        "dose_pediatric": "No recomendado en menores de 12 años.",
        "contraindications": "Uso con IMAO, asma, EPOC, hipersensibilidad.",
        "minimumAge": "12 años",
        "pregnancy": "Categoría C (Según FDA)",
        "lactation": "Riesgo Bajo (Según e-lactancia.org)"
    },
    {
        "name": "Bencidamina",
        "presentation": "Solución Bucofaríngea 45mg/100ml",
        "family": "AINE Tópico",
        "simpleFamily": "Analgésicos",
        "uses": "Alivio del dolor e inflamación de boca y garganta.",
        "indications": "Dolor de garganta agudo, estomatitis, gingivitis, post-extracciones dentales.",
        "dose_adult": "Realizar gárgaras o enjuagues con 15 ml, 2 a 3 veces al día.",
        "dose_pediatric": "Niños 6-12 años: Mitad de la dosis de adulto.",
        "contraindications": "Hipersensibilidad.",
        "minimumAge": "6 años",
        "pregnancy": "Categoría C (Según FDA) - Evitar",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Bencidamina Clorhidrato",
        "presentation": "Gel 5g/100g",
        "family": "AINE Tópico",
        "simpleFamily": "Antiinflamatorios",
        "uses": "Alivio del dolor e inflamación muscular y articular.",
        "indications": "Dolor muscular, articular, torceduras, esguinces, tendinitis.",
        "dose_adult": "Aplicar una capa delgada en el área afectada 3-4 veces al día.",
        "dose_pediatric": "Niños >12 años: Misma dosis que adultos.",
        "contraindications": "Hipersensibilidad, no aplicar en piel lesionada.",
        "minimumAge": "12 años",
        "pregnancy": "Categoría D (Según FDA) - 3er Trimestre",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Piroxicam",
        "presentation": "Gel 0.5g/100g",
        "family": "AINE Tópico",
        "simpleFamily": "Antiinflamatorios",
        "uses": "Alivio del dolor e inflamación local.",
        "indications": "Dolor muscular, articular, osteoartritis superficial, tendinitis.",
        "dose_adult": "Aplicar en el área afectada 3-4 veces al día.",
        "dose_pediatric": "No recomendado.",
        "contraindications": "Hipersensibilidad a AINEs.",
        "minimumAge": "12 años",
        "pregnancy": "Categoría D (Según FDA) - 3er Trimestre",
        "lactation": "Riesgo Bajo (Según e-lactancia.org)"
    },
    {
        "name": "Ribavirina",
        "presentation": "Cápsulas 400 mg",
        "family": "Análogo Nucleósido Sintético",
        "simpleFamily": "Antivirales",
        "uses": "Tratamiento de la Hepatitis C crónica (en combinación).",
        "indications": "Hepatitis C crónica, en combinación con otros antivirales como interferón.",
        "dose_adult": "Dosis ajustada por peso y genotipo del virus, bajo supervisión de especialista.",
        "dose_pediatric": "Uso por especialista.",
        "contraindications": "Embarazo (teratogénico), anemia severa, hemoglobinopatías, insuficiencia renal grave.",
        "minimumAge": "3 años",
        "pregnancy": "Categoría X (Según FDA) - Contraindicado",
        "lactation": "Riesgo Alto - Contraindicado (Según e-lactancia.org)",
        "renalDoseAdjust": { "enabled": true }
    },
    {
        "name": "SimiWell Forte (Betaglucanos/Vit C/Zinc/D3)",
        "presentation": "30 Cápsulas",
        "family": "Inmunomodulador / Suplemento",
        "simpleFamily": "Vitaminas y Suplementos",
        "uses": "Refuerzo del sistema inmunitario.",
        "indications": "Prevención de infecciones respiratorias, coadyuvante en estados de convalecencia.",
        "dose_adult": "1-2 cápsulas al día.",
        "dose_pediatric": "No recomendado en niños pequeños.",
        "contraindications": "Hipersensibilidad a los componentes.",
        "minimumAge": "12 años",
        "pregnancy": "Categoría A (Según FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Proteína Whey X-Gear",
        "presentation": "Polvo 450 gr (Sabor Chocolate)",
        "family": "Suplemento Nutricional",
        "simpleFamily": "Vitaminas y Suplementos",
        "uses": "Suplemento proteico para deportistas.",
        "indications": "Apoyo a la recuperación muscular y al aumento de masa muscular post-entrenamiento.",
        "dose_adult": "1 medida (scoop) disuelta en agua o leche después del ejercicio.",
        "dose_pediatric": "No recomendado.",
        "contraindications": "Alergia a la proteína de leche (lactosa), fenilcetonuria.",
        "minimumAge": "18 años",
        "pregnancy": "Categoría A (Según FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Bebida Efervescente 0% Azúcar X-Gear",
        "presentation": "10 Tabletas Efervescentes (Sabor Fresa)",
        "family": "Suplemento / Hidratante",
        "simpleFamily": "Vitaminas y Suplementos",
        "uses": "Bebida hidratante y energética sin azúcar.",
        "indications": "Rehidratación durante o después del ejercicio, aporte de electrolitos y vitaminas.",
        "dose_adult": "Disolver 1 tableta en un vaso de agua.",
        "dose_pediatric": "Uso no recomendado.",
        "contraindications": "Hipersensibilidad a los componentes.",
        "minimumAge": "12 años",
        "pregnancy": "Categoría A (Según FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Dutasterida / Tamsulosina",
        "presentation": "Cápsulas 0.5mg/0.4mg",
        "family": "Combinación (Inhibidor 5-alfa reductasa + Bloqueador alfa-1)",
        "simpleFamily": "Urológicos y Salud Masculina",
        "uses": "Tratamiento de la hiperplasia prostática benigna (HPB).",
        "indications": "Síntomas moderados a graves de HPB para reducir el tamaño de la próstata, mejorar el flujo urinario y disminuir el riesgo de retención urinaria.",
        "dose_adult": "1 cápsula al día, 30 minutos después de la misma comida cada día.",
        "dose_pediatric": "No indicado.",
        "contraindications": "Mujeres, niños, hipersensibilidad, insuficiencia hepática grave.",
        "minimumAge": "18 años",
        "pregnancy": "Categoría X (Según FDA) - Contraindicado",
        "lactation": "Riesgo Alto - Contraindicado (Según Fabricante)"
    },
    {
        "name": "Betahistina",
        "presentation": "Tabletas 24 mg",
        "family": "Análogo de la Histamina",
        "simpleFamily": "Antivertiginosos",
        "uses": "Tratamiento del vértigo y síndrome de Ménière.",
        "indications": "Vértigo, tinnitus (zumbido de oídos) y pérdida de audición asociados al síndrome de Ménière.",
        "dose_adult": "24 mg dos veces al día.",
        "dose_pediatric": "No recomendado.",
        "contraindications": "Feocromocitoma, hipersensibilidad.",
        "minimumAge": "18 años",
        "pregnancy": "Categoría C (Según FDA) - Evitar",
        "lactation": "Riesgo Alto - Evitar (Según e-lactancia.org)"
    },
    {
        "name": "Citicolina",
        "presentation": "Tabletas 500 mg",
        "family": "Neuroprotector / Nootrópico",
        "simpleFamily": "Neurológicos",
        "uses": "Mejora de la función cognitiva y recuperación neurológica.",
        "indications": "Trastornos cognitivos y de memoria de origen vascular o degenerativo, coadyuvante en la recuperación de un EVC.",
        "dose_adult": "500-1000 mg al día, divididos en 1-2 dosis.",
        "dose_pediatric": "No recomendado de rutina.",
        "contraindications": "Hipersensibilidad, hipertonía del sistema nervioso parasimpático.",
        "minimumAge": "18 años",
        "pregnancy": "Categoría C (Según FDA) - Evaluar",
        "lactation": "Riesgo Alto - Evitar (Según Fabricante)"
    },
    {
        "name": "Hidroxizina",
        "presentation": "Tabletas 25mg",
        "family": "Antihistamínico H1 de 1ª Generación (Piperazina)",
        "simpleFamily": "Antialérgicos",
        "uses": "Alivio del prurito (picazón) y tratamiento de la ansiedad.",
        "indications": "Urticaria, dermatitis, ansiedad leve a moderada, sedación.",
        "dose_adult": "Ansiedad: 50-100 mg 4 veces/día. Prurito: 25 mg 3-4 veces/día.",
        "dose_pediatric": ">6 años: 50-100 mg/día en dosis divididas. <6 años: 50 mg/día en dosis divididas.",
        "contraindications": "Embarazo, lactancia, hipersensibilidad, prolongación del intervalo QT.",
        "minimumAge": "1 año",
        "pregnancy": "Categoría C (Según FDA) - Contraindicado en 1er trimestre",
        "lactation": "Riesgo Alto - Contraindicado (Según e-lactancia.org)"
    },
    {
        "name": "Sumatriptán",
        "presentation": "Comprimidos 100 mg",
        "family": "Agonista 5-HT1 (Triptano)",
        "simpleFamily": "Analgésicos",
        "uses": "Tratamiento agudo de la migraña.",
        "indications": "Ataques agudos de migraña con o sin aura.",
        "dose_adult": "50-100 mg al inicio del dolor. Se puede repetir una dosis después de 2 horas si la migraña persiste (máx. 300 mg/día).",
        "dose_pediatric": "No recomendado.",
        "contraindications": "Cardiopatía isquémica, EVC previo, hipertensión no controlada, uso con IMAO o ergotamínicos.",
        "minimumAge": "18 años",
        "pregnancy": "Categoría C (Según FDA) - Evaluar",
        "lactation": "Riesgo Bajo (Según e-lactancia.org)"
    },
    {
        "name": "Ácido Cítrico / Citrato de Potasio",
        "presentation": "Solución Oral",
        "family": "Alcalinizante Urinario",
        "simpleFamily": "Urológicos y Salud Masculina",
        "uses": "Prevención de cálculos renales.",
        "indications": "Prevención de la formación de cálculos de ácido úrico y oxalato de calcio, alcalinización de la orina.",
        "dose_adult": "10-20 ml diluidos en agua, 2-3 veces al día después de las comidas.",
        "dose_pediatric": "Según indicación médica.",
        "contraindications": "Insuficiencia renal severa, hiperpotasemia, infección urinaria activa.",
        "minimumAge": "1 año",
        "pregnancy": "Categoría C (Según FDA) - Seguro en dosis habituales",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)",
        "renalDoseAdjust": { "enabled": true }
    },
    {
        "name": "Modafinilo",
        "presentation": "Tabletas 200 mg",
        "family": "Agente Estimulante de la Vigilia",
        "simpleFamily": "Neurológicos",
        "uses": "Tratamiento de la somnolencia excesiva.",
        "indications": "Narcolepsia, somnolencia diurna excesiva asociada a apnea obstructiva del sueño o trastorno del sueño por trabajo por turnos.",
        "dose_adult": "200 mg una vez al día por la mañana.",
        "dose_pediatric": "No recomendado.",
        "contraindications": "Hipersensibilidad, antecedentes de arritmias, hipertensión no controlada.",
        "notes": "Medicamento con potencial de abuso. Requiere supervisión médica estricta.",
        "minimumAge": "17 años",
        "pregnancy": "Categoría C (Según FDA) - Evitar",
        "lactation": "Riesgo Alto - Evitar (Según e-lactancia.org)"
    },
    {
        "name": "Saw Palmetto (Serenoa Repens)",
        "presentation": "Cápsulas 160mg",
        "family": "Fitofármaco",
        "simpleFamily": "Urológicos y Salud Masculina",
        "uses": "Alivio de los síntomas de la hiperplasia prostática benigna (HPB).",
        "indications": "Síntomas del tracto urinario inferior asociados a HPB leve a moderada.",
        "dose_adult": "160 mg dos veces al día o 320 mg una vez al día.",
        "dose_pediatric": "No indicado.",
        "contraindications": "Hipersensibilidad.",
        "minimumAge": "18 años",
        "pregnancy": "Contraindicado",
        "lactation": "Contraindicado"
    },
    {
        "name": "Febuxostat",
        "presentation": "Tabletas 80mg",
        "family": "Inhibidor de la Xantina Oxidasa no purínico",
        "simpleFamily": "Antiinflamatorios",
        "uses": "Reduce la producción de ácido úrico.",
        "indications": "Gota crónica, hiperuricemia en pacientes que no toleran alopurinol.",
        "dose_adult": "80 mg una vez al día.",
        "dose_pediatric": "No recomendado.",
        "contraindications": "Hipersensibilidad, uso con azatioprina o mercaptopurina.",
        "minimumAge": "18 años",
        "pregnancy": "Categoría C (Según FDA) - Evitar",
        "lactation": "Riesgo Alto - Evitar (Según Fabricante)"
    },
    {
        "name": "Leflunomida",
        "presentation": "Comprimidos 20 mg",
        "family": "Agente Antirreumático Modificador de la Enfermedad (FARME)",
        "simpleFamily": "Antiinflamatorios",
        "uses": "Tratamiento de la artritis reumatoide y artritis psoriásica.",
        "indications": "Artritis reumatoide activa, artritis psoriásica activa.",
        "dose_adult": "Dosis de carga opcional, seguida de 20 mg una vez al día.",
        "dose_pediatric": "No recomendado.",
        "contraindications": "Embarazo, insuficiencia hepática severa, inmunodeficiencia severa.",
        "minimumAge": "18 años",
        "pregnancy": "Categoría X (Según FDA) - Contraindicado",
        "lactation": "Riesgo Alto - Contraindicado (Según e-lactancia.org)"
    },
    {
        "name": "Silybum Marianum (Cardo Mariano)",
        "presentation": "Comprimidos 187.50mg",
        "family": "Hepatoprotector / Fitofármaco",
        "simpleFamily": "Vitaminas y Suplementos",
        "uses": "Protección y soporte de la función hepática.",
        "indications": "Coadyuvante en el tratamiento de enfermedades hepáticas inflamatorias crónicas y cirrosis hepática.",
        "dose_adult": "1 comprimido 2-3 veces al día.",
        "dose_pediatric": "No recomendado.",
        "contraindications": "Hipersensibilidad.",
        "minimumAge": "18 años",
        "pregnancy": "Categoría B (Según FDA) - Probablemente seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Acarbosa",
        "presentation": "Tabletas 50mg / 100mg",
        "family": "Inhibidor de la Alfa-glucosidasa",
        "simpleFamily": "Antidiabéticos",
        "uses": "Control de glucosa en sangre para diabetes tipo 2.",
        "indications": "Diabetes mellitus tipo 2, especialmente en pacientes con picos de glucosa después de comer (hiperglucemia posprandial).",
        "dose_adult": "Inicial: 25-50 mg tres veces al día con el primer bocado de cada comida. Máximo: 100 mg tres veces al día.",
        "dose_pediatric": "No recomendado.",
        "contraindications": "Enfermedad inflamatoria intestinal, obstrucción intestinal, hipersensibilidad.",
        "minimumAge": "18 años",
        "pregnancy": "Categoría B (Según FDA) - Evitar",
        "lactation": "Riesgo Alto - Evitar (Según e-lactancia.org)"
    },
    {
        "name": "Acetilcisteína",
        "presentation": "Polvo / Granulado para solución oral",
        "family": "Mucolítico",
        "simpleFamily": "Respiratorios",
        "uses": "Fluidifica y facilita la expulsión de flemas.",
        "indications": "Afecciones respiratorias con secreción mucosa densa y viscosa, como bronquitis, EPOC. Antídoto en intoxicación por paracetamol.",
        "dose_adult": "200 mg cada 8 horas o 600 mg una vez al día.",
        "dose_pediatric": "Niños >2 años: 100 mg cada 8-12 horas.",
        "contraindications": "Úlcera péptica activa, hipersensibilidad.",
        "minimumAge": "2 años",
        "pregnancy": "Categoría B (Según FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Aciclovir",
        "presentation": "Tabletas 200mg",
        "family": "Análogo Nucleósido de Guanina",
        "simpleFamily": "Antivirales",
        "uses": "Tratamiento de infecciones virales por herpes.",
        "indications": "Herpes labial (fuegos), herpes genital, varicela, herpes zóster (culebrilla).",
        "dose_adult": "Herpes simple: 200 mg 5 veces/día. Herpes zóster: 800 mg 5 veces/día.",
        "dose_pediatric": "Varicela: 20 mg/kg/dosis (máx. 800 mg) 4 veces/día.",
        "contraindications": "Hipersensibilidad.",
        "minimumAge": "Recién nacido",
        "pregnancy": "Categoría B (Según FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Aciclovir",
        "presentation": "Tabletas 400mg",
        "family": "Análogo Nucleósido de Guanina",
        "simpleFamily": "Antivirales",
        "uses": "Tratamiento y prevención de infecciones por herpes.",
        "indications": "Herpes zóster, profilaxis en inmunocomprometidos, supresión de herpes genital recurrente.",
        "dose_adult": "Herpes zóster: 800 mg 5 veces/día. Profilaxis: 400 mg dos veces al día.",
        "dose_pediatric": "Según indicación médica.",
        "contraindications": "Hipersensibilidad.",
        "minimumAge": "Recién nacido",
        "pregnancy": "Categoría B (Según FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Aciclovir",
        "presentation": "Suspensión Oral 4g/100ml (200mg/5ml)",
        "family": "Análogo Nucleósido de Guanina",
        "simpleFamily": "Antivirales",
        "uses": "Tratamiento de infecciones virales en niños.",
        "indications": "Varicela, herpes simple (gingivoestomatitis herpética).",
        "dose_adult": "No es la presentación usual.",
        "dose_pediatric": "Varicela: 20 mg/kg/dosis (máx. 800 mg) 4 veces/día.",
        "contraindications": "Hipersensibilidad.",
        "isCalculable": true,
        "concentration": 40,
        "doseMin_mg_kg_dosis": 20,
        "doseMax_mg_kg_dosis": 20,
        "doseFreq": 4,
        "minimumAge": "Recién nacido",
        "pregnancy": "Categoría B (Según FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Ácido Fólico",
        "presentation": "Tabletas 400mcg / 5mg",
        "family": "Vitamina del Complejo B",
        "simpleFamily": "Vitaminas y Suplementos",
        "uses": "Prevención de malformaciones fetales y tratamiento de anemias.",
        "indications": "Suplementación preconcepcional y durante el embarazo para prevenir defectos del tubo neural, anemia por deficiencia de folato (megaloblástica).",
        "dose_adult": "Prevención: 400 mcg/día. Tratamiento: 1-5 mg/día.",
        "dose_pediatric": "Según indicación médica.",
        "contraindications": "Anemia perniciosa no tratada (puede enmascarar síntomas neurológicos).",
        "minimumAge": "Recién nacido",
        "pregnancy": "Categoría A (Según FDA) - Recomendado",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Ácido Fusídico / Betametasona",
        "presentation": "Crema 20mg/1mg (15g)",
        "family": "Combinación (Antibiótico + Corticosteroide Tópico)",
        "simpleFamily": "Dermatológicos",
        "uses": "Tratamiento de problemas de piel con inflamación e infección.",
        "indications": "Dermatitis atópica, dermatitis por contacto, eccema infectado por bacterias sensibles al ácido fusídico.",
        "dose_adult": "Aplicar una capa delgada 2-3 veces al día.",
        "dose_pediatric": "Usar con precaución y por periodos cortos.",
        "contraindications": "Infecciones virales o fúngicas de la piel, acné rosácea, hipersensibilidad.",
        "minimumAge": "1 mes",
        "pregnancy": "Categoría C (Según FDA) - Evaluar",
        "lactation": "Riesgo Bajo (Según e-lactancia.org)"
    },
    {
        "name": "Ácido Ursodeoxicólico",
        "presentation": "Tabletas 250mg",
        "family": "Ácido biliar",
        "simpleFamily": "Gastrointestinales",
        "uses": "Disolución de cálculos biliares y tratamiento de enfermedades hepáticas.",
        "indications": "Cálculos biliares de colesterol, colangitis biliar primaria, enfermedad hepática colestásica.",
        "dose_adult": "8-10 mg/kg/día divididos en 2-3 dosis.",
        "dose_pediatric": "No recomendado de forma rutinaria.",
        "contraindications": "Obstrucción biliar completa, hipersensibilidad.",
        "minimumAge": "18 años",
        "pregnancy": "Categoría B (Según FDA) - Evaluar",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Albendazol",
        "presentation": "Suspensión Oral 2g/100ml (400mg/20ml)",
        "family": "Benzimidazol (Antihelmíntico)",
        "simpleFamily": "Antiparasitarios",
        "uses": "Tratamiento de infecciones por lombrices y parásitos intestinales.",
        "indications": "Ascaridiasis (lombrices), tricuriasis (tricocéfalos), anquilostomiasis, oxiuriasis (piduyes).",
        "dose_adult": "400 mg (20ml) dosis única.",
        "dose_pediatric": "Niños >2 años: 400 mg (20ml) dosis única. Niños 1-2 años: 200 mg (10ml) dosis única.",
        "contraindications": "Embarazo, hipersensibilidad.",
        "minimumAge": "1 año",
        "pregnancy": "Categoría C (Según FDA) - Contraindicado",
        "lactation": "Riesgo Bajo (Según e-lactancia.org) - Dosis única"
    },
    {
        "name": "Albendazol",
        "presentation": "Tabletas 200mg / 400mg",
        "family": "Benzimidazol (Antihelmíntico)",
        "simpleFamily": "Antiparasitarios",
        "uses": "Desparasitante de amplio espectro.",
        "indications": "Ascaridiasis, tricuriasis, anquilostomiasis, teniasis (solitaria), neurocisticercosis, hidatidosis.",
        "dose_adult": "400 mg dosis única para parásitos comunes. Dosis más altas y prolongadas para infecciones sistémicas.",
        "dose_pediatric": "Niños >2 años: 400 mg dosis única.",
        "contraindications": "Embarazo, hipersensibilidad.",
        "minimumAge": "2 años",
        "pregnancy": "Categoría C (Según FDA) - Contraindicado",
        "lactation": "Riesgo Bajo (Según e-lactancia.org) - Dosis única"
    },
    {
        "name": "Aluminio / Magnesio",
        "presentation": "Suspensión Oral",
        "family": "Antiácido",
        "simpleFamily": "Gastrointestinales",
        "uses": "Alivio rápido de la acidez y el malestar estomacal.",
        "indications": "Acidez estomacal, indigestión, dispepsia, alivio sintomático del reflujo gastroesofágico, gastritis.",
        "dose_adult": "10-20 ml entre comidas y al acostarse.",
        "dose_pediatric": "Niños >6 años: 5-10 ml.",
        "contraindications": "Insuficiencia renal grave, hipersensibilidad.",
        "minimumAge": "6 años",
        "pregnancy": "Categoría B (Según FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)",
        "renalDoseAdjust": { "enabled": true }
    },
    {
        "name": "Aluminio / Magnesio",
        "presentation": "Tabletas Masticables",
        "family": "Antiácido",
        "simpleFamily": "Gastrointestinales",
        "uses": "Alivio rápido de la acidez estomacal.",
        "indications": "Acidez estomacal, indigestión, dispepsia.",
        "dose_adult": "1-2 tabletas masticadas entre comidas y al acostarse.",
        "dose_pediatric": "Niños >6 años: 1 tableta.",
        "contraindications": "Insuficiencia renal grave, hipersensibilidad.",
        "minimumAge": "6 años",
        "pregnancy": "Categoría B (Según FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)",
        "renalDoseAdjust": { "enabled": true }
    },
    {
        "name": "Alosuan",
        "presentation": "Polvo",
        "family": "Combinación Antiséptica y Astringente",
        "simpleFamily": "Dermatológicos",
        "uses": "Polvo secante para irritaciones de la piel.",
        "indications": "Lesiones cutáneas leves, rozaduras, control de la sudoración excesiva (pies, axilas).",
        "dose_adult": "Aplicar una fina capa sobre el área afectada 2-3 veces al día.",
        "dose_pediatric": "Uso en niños bajo supervisión médica.",
        "contraindications": "Hipersensibilidad a los componentes, no usar en heridas abiertas profundas o quemaduras graves.",
        "minimumAge": "3 meses",
        "pregnancy": "Categoría A (Según FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Alverina / Simeticona",
        "presentation": "Cápsulas 60mg/300mg",
        "family": "Antiespasmódico Musculotrópico / Antiflatulento",
        "simpleFamily": "Gastrointestinales",
        "uses": "Alivio de cólicos, espasmos y gases intestinales.",
        "indications": "Síndrome de intestino irritable (colitis) con distensión abdominal y flatulencia.",
        "dose_adult": "1 cápsula 2-3 veces al día.",
        "dose_pediatric": "No recomendado.",
        "contraindications": "Obstrucción intestinal, hipersensibilidad.",
        "minimumAge": "12 años",
        "pregnancy": "Categoría C (Según FDA) - Evitar",
        "lactation": "Riesgo Bajo (Según e-lactancia.org)"
    },
    {
        "name": "Ambroxol",
        "presentation": "Jarabe (ej. 300mg/100ml)",
        "family": "Mucolítico / Expectorante",
        "simpleFamily": "Respiratorios",
        "uses": "Facilita la expulsión de flemas en tos productiva.",
        "indications": "Bronquitis aguda y crónica, neumonía, y otros procesos respiratorios con secreciones viscosas.",
        "dose_adult": "30 mg (10 ml) tres veces al día.",
        "dose_pediatric": "Niños 2-5 años: 7.5 mg (2.5 ml) 3 veces/día. 6-12 años: 15 mg (5 ml) 2-3 veces/día.",
        "contraindications": "Hipersensibilidad, primer trimestre del embarazo.",
        "isCalculable": true,
        "concentration": 3,
        "doseMin_mg_kg_dia": 1.2,
        "doseMax_mg_kg_dia": 1.6,
        "doseIntervals": "2-3",
        "minimumAge": "2 años",
        "pregnancy": "Categoría B (Según FDA) - Evitar 1er Trimestre",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Ambroxol",
        "presentation": "Gotas Pediátricas (ej. 7.5mg/ml)",
        "family": "Mucolítico / Expectorante",
        "simpleFamily": "Respiratorios",
        "uses": "Facilita la expulsión de flemas en bebés y niños.",
        "indications": "Procesos respiratorios con secreciones viscosas en lactantes y niños.",
        "dose_adult": "No aplica.",
        "dose_pediatric": "Niños <2 años: 7.5 mg (1 ml) dos veces al día. 2-5 años: 7.5 mg (1 ml) tres veces al día.",
        "contraindications": "Hipersensibilidad.",
        "isCalculable": true,
        "isDrops": true,
        "concentration": 7.5,
        "doseMin_mg_kg_dia": 1.2,
        "doseMax_mg_kg_dia": 1.6,
        "doseIntervals": "2-3",
        "minimumAge": "1 mes",
        "pregnancy": "Categoría B (Según FDA) - Evitar 1er Trimestre",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Ambroxol",
        "presentation": "Tabletas 30mg",
        "family": "Mucolítico / Expectorante",
        "simpleFamily": "Respiratorios",
        "uses": "Facilita la expulsión de flemas en adultos.",
        "indications": "Bronquitis aguda y crónica, neumonía, y otros procesos respiratorios con secreciones.",
        "dose_adult": "30 mg tres veces al día.",
        "dose_pediatric": "Niños 6-12 años: 15 mg (media tableta) 2-3 veces al día.",
        "contraindications": "Hipersensibilidad, primer trimestre del embarazo.",
        "minimumAge": "6 años",
        "pregnancy": "Categoría B (Según FDA) - Evitar 1er Trimestre",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Ambroxol / Clenbuterol",
        "presentation": "Jarabe (ej. 7.5mg/0.005mg por 5ml)",
        "family": "Combinación (Mucolítico + Broncodilatador β2)",
        "simpleFamily": "Respiratorios",
        "uses": "Tratamiento para tos con flemas y dificultad para respirar.",
        "indications": "Bronquitis aguda y crónica, asma bronquial, EPOC con componente secretor.",
        "dose_adult": "10 ml (15mg/0.01mg) cada 12 horas.",
        "dose_pediatric": "Niños 6-12 años: 5 ml cada 12 horas. Niños 2-6 años: 2.5 ml cada 12 horas.",
        "contraindications": "Hipersensibilidad, estenosis aórtica subvalvular, taquiarritmias, primer trimestre del embarazo.",
        "minimumAge": "2 años",
        "pregnancy": "Categoría C (Según FDA) - Contraindicado",
        "lactation": "Riesgo Alto - Contraindicado (Según e-lactancia.org)"
    },
    {
        "name": "Amlodipino",
        "presentation": "Tabletas 5mg / 10mg",
        "family": "Calcioantagonista Dihidropiridínico",
        "simpleFamily": "Antihipertensivos",
        "uses": "Tratamiento para la presión arterial alta y dolor de pecho.",
        "indications": "Hipertensión arterial, angina de pecho estable y vasoespástica (angina de Prinzmetal).",
        "dose_adult": "Inicial: 5 mg/día. Máximo: 10 mg/día.",
        "dose_pediatric": "2.5-5 mg/día.",
        "contraindications": "Hipotensión severa, shock cardiogénico, estenosis aórtica severa.",
        "minimumAge": "6 años",
        "pregnancy": "Categoría C (Según FDA) - Evaluar",
        "lactation": "Riesgo Bajo (Según e-lactancia.org)"
    },
    {
        "name": "Amoxicilina",
        "presentation": "Cápsulas 500mg",
        "family": "Aminopenicilina (Betalactámico)",
        "simpleFamily": "Antibióticos",
        "uses": "Antibiótico para infecciones bacterianas comunes.",
        "indications": "Otitis media, faringitis estreptocócica, neumonía, infecciones de piel (celulitis), infecciones de vías urinarias.",
        "dose_adult": "250-500 mg cada 8 horas.",
        "dose_pediatric": "25-50 mg/kg/día, dividido en 2-3 dosis.",
        "contraindications": "Hipersensibilidad a penicilinas.",
        "minimumAge": "Recién nacido",
        "pregnancy": "Categoría B (Según FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Amoxicilina",
        "presentation": "Suspensión Oral (ej. 250mg/5ml)",
        "family": "Aminopenicilina (Betalactámico)",
        "simpleFamily": "Antibióticos",
        "uses": "Antibiótico para infecciones bacterianas en niños.",
        "indications": "Otitis media, faringitis estreptocócica, neumonía, infecciones de piel y vías urinarias.",
        "dose_adult": "No es la presentación usual para adultos.",
        "dose_pediatric": "Dosis estándar: 25-50 mg/kg/día, dividido en 2-3 dosis. Otitis media severa: 80-90 mg/kg/día, dividido en 2 dosis.",
        "contraindications": "Hipersensibilidad a penicilinas.",
        "isCalculable": true,
        "concentration": 50,
        "doseMin_mg_kg_dia": 25,
        "doseMax_mg_kg_dia": 90,
        "doseIntervals": "2-3",
        "minimumAge": "Recién nacido",
        "pregnancy": "Categoría B (FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Amoxicilina / Ácido Clavulánico",
        "presentation": "Tabletas 500mg/125mg",
        "family": "Aminopenicilina con Inhibidor de Betalactamasa",
        "simpleFamily": "Antibióticos",
        "uses": "Antibiótico de amplio espectro para infecciones resistentes.",
        "indications": "Sinusitis bacteriana, otitis media, infecciones del tracto respiratorio inferior, piel (mordeduras) y vías urinarias complicadas.",
        "dose_adult": "500/125 mg cada 8 horas o 875/125 mg cada 12 horas.",
        "dose_pediatric": "Basado en amoxicilina: 25-45 mg/kg/día, dividido en 2-3 dosis.",
        "contraindications": "Hipersensibilidad a penicilinas, antecedentes de ictericia colestásica asociada ao fármaco.",
        "minimumAge": "Recién nacido",
        "pregnancy": "Categoría B (FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Amoxicilina / Ácido Clavulánico",
        "presentation": "Suspensión Oral (ej. 250mg/62.5mg por 5ml)",
        "family": "Aminopenicilina con Inhibidor de Betalactamasa",
        "simpleFamily": "Antibióticos",
        "uses": "Antibiótico de amplio espectro para niños.",
        "indications": "Sinusitis, otitis media, infecciones del tracto respiratorio inferior, piel y vías urinarias.",
        "dose_adult": "No es la presentación usual para adultos.",
        "dose_pediatric": "Basado en amoxicilina: Dosis estándar 25-45 mg/kg/día, dividido en 2 dosis. Infecciones severas (otitis, sinusitis): 80-90 mg/kg/día, dividido en 2 dosis.",
        "contraindications": "Hipersensibilidad a penicilinas, antecedentes de ictericia colestásica asociada ao fármaco.",
        "isCalculable": true,
        "concentration": 50,
        "doseMin_mg_kg_dia": 25,
        "doseMax_mg_kg_dia": 90,
        "doseIntervals": "2",
        "minimumAge": "Recién nacido",
        "pregnancy": "Categoría B (FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Atorvastatina",
        "presentation": "Tabletas 10mg / 20mg / 40mg",
        "family": "Estatina (Inhibidor de HMG-CoA Reductasa)",
        "simpleFamily": "Hipolipemiantes",
        "uses": "Reducción del colesterol elevado y prevención cardiovascular.",
        "indications": "Hipercolesterolemia, prevención de eventos cardiovasculares (infarto, EVC) en pacientes con factores de riesgo.",
        "dose_adult": "10-80 mg una vez al día.",
        "dose_pediatric": "Niños >10 años: 10 mg/día (máx. 20 mg/día).",
        "contraindications": "Enfermedad hepática activa, embarazo, lactancia.",
        "minimumAge": "10 años",
        "pregnancy": "Categoría X (FDA) - Contraindicado",
        "lactation": "Riesgo Alto - Contraindicado (Según e-lactancia.org)"
    },
    {
        "name": "Azitromicina",
        "presentation": "Tabletas 500mg",
        "family": "Macrólido (Antibiótico)",
        "simpleFamily": "Antibióticos",
        "uses": "Antibiótico para infecciones respiratorias, de piel y de transmisión sexual.",
        "indications": "Faringitis, bronquitis, neumonía atípica, infecciones por Chlamydia trachomatis.",
        "dose_adult": "500 mg el primer día, luego 250 mg diarios por 4 días.",
        "dose_pediatric": "10 mg/kg/día el primer día, seguido de 5 mg/kg/día por 4 días.",
        "contraindications": "Hipersensibilidad a macrólidos, historia de disfunción hepática con uso previo.",
        "minimumAge": "6 meses",
        "pregnancy": "Categoría B (FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Baño Coloide",
        "presentation": "Polvo para suspensión (sobre 90g)",
        "family": "Emoliente y Protector Cutáneo",
        "simpleFamily": "Dermatológicos",
        "uses": "Alivio de la comezón e irritación de la piel.",
        "indications": "Dermatitis atópica, varicela, urticaria, quemaduras solares leves, piel seca y con prurito.",
        "dose_adult": "Disolver un sobre en agua de tina y tomar un baño de 15-20 minutos.",
        "dose_pediatric": "Misma dosis que adultos.",
        "contraindications": "Hipersensibilidad a los componentes.",
        "minimumAge": "Recién nacido",
        "pregnancy": "Categoría A (FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Benzonatato",
        "presentation": "Perlas 100mg",
        "family": "Antitusígeno no narcótico",
        "simpleFamily": "Respiratorios",
        "uses": "Alivio de la tos seca e irritativa.",
        "indications": "Tos no productiva asociada a resfriado común, bronquitis, etc.",
        "dose_adult": "100-200 mg tres veces al día. No masticar.",
        "dose_pediatric": "Niños >10 años: Misma dosis que adultos.",
        "contraindications": "Hipersensibilidad. No usar en niños <10 años.",
        "minimumAge": "10 años",
        "pregnancy": "Categoría C (FDA) - Evaluar",
        "lactation": "Riesgo Alto - Evitar (Según Fabricante)"
    },
    {
        "name": "Betametasona",
        "presentation": "Solución Inyectable 4mg/1ml",
        "family": "Glucocorticoide Sistémico",
        "simpleFamily": "Corticosteroides",
        "uses": "Antiinflamatorio potente para condiciones agudas.",
        "indications": "Asma grave, reacciones alérgicas agudas, enfermedades reumáticas, maduración pulmonar fetal.",
        "dose_adult": "Dosis variable según la condición, usualmente 4 a 20 mg (IM).",
        "dose_pediatric": "0.02 a 0.3 mg/kg/día dividido en 3-4 dosis.",
        "contraindications": "Infecciones fúngicas sistémicas, hipersensibilidad.",
        "minimumAge": "Recién nacido",
        "pregnancy": "Categoría C (FDA) - Seguro para maduración pulmonar",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Betametasona / Gentamicina / Clotrimazol",
        "presentation": "Crema Tópica 40g",
        "family": "Combinación (Corticosteroide + Antibiótico + Antifúngico)",
        "simpleFamily": "Dermatológicos",
        "uses": "Tratamiento de infecciones de la piel con inflamación.",
        "indications": "Dermatitis infectadas por bacterias u hongos sensibles, pie de atleta, tiña inguinal.",
        "dose_adult": "Aplicar una capa delgada en el área afectada dos veces al día.",
        "dose_pediatric": "Usar con precaución y por periodos cortos.",
        "contraindications": "Hipersensibilidad, infecciones virales cutáneas (herpes, varicela).",
        "minimumAge": "2 años",
        "pregnancy": "Categoría C (FDA) - Evaluar",
        "lactation": "Riesgo Bajo (Según e-lactancia.org)"
    },
    {
        "name": "Bezafibrato",
        "presentation": "Tabletas 200mg",
        "family": "Fibrato",
        "simpleFamily": "Hipolipemiantes",
        "uses": "Reducción de triglicéridos y colesterol.",
        "indications": "Hipertrigliceridemia, hiperlipidemia mixta.",
        "dose_adult": "200 mg tres veces al día con las comidas.",
        "dose_pediatric": "No recomendado.",
        "contraindications": "Insuficiencia hepática o renal severa, enfermedad de la vesícula biliar.",
        "minimumAge": "18 años",
        "pregnancy": "Categoría C (FDA) - Contraindicado",
        "lactation": "Riesgo Alto - Contraindicado (Según e-lactancia.org)"
    },
    {
        "name": "Bimin",
        "presentation": "30 Tabletas",
        "family": "Multivitamínico",
        "simpleFamily": "Vitaminas y Suplementos",
        "uses": "Suplemento vitamínico para deficiencias nutricionales.",
        "indications": "Prevención y tratamiento de deficiencias de vitaminas y minerales contenidas en la fórmula.",
        "dose_adult": "1 tableta al día.",
        "dose_pediatric": "Niños >12 años: 1 tableta al día.",
        "contraindications": "Hipersensibilidad a cualquiera de los componentes de la fórmula.",
        "minimumAge": "12 años",
        "pregnancy": "Categoría A (FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Bromhexina",
        "presentation": "Tabletas 8mg",
        "family": "Mucolítico",
        "simpleFamily": "Respiratorios",
        "uses": "Fluidifica las secreciones bronquiales, facilitando su expulsión.",
        "indications": "Bronquitis aguda y crónica, traqueobronquitis.",
        "dose_adult": "8 mg tres veces al día.",
        "dose_pediatric": "Niños 6-12 años: 4 mg tres veces al día. No recomendado en <6 años.",
        "contraindications": "Hipersensibilidad, úlcera péptica activa.",
        "minimumAge": "6 años",
        "pregnancy": "Categoría C (FDA) - Evitar 1er Trimestre",
        "lactation": "Riesgo Bajo (Según e-lactancia.org)"
    },
    {
        "name": "Bromhexina",
        "presentation": "Jarabe 80mg/100ml (4mg/5ml)",
        "family": "Mucolítico",
        "simpleFamily": "Respiratorios",
        "uses": "Fluidifica las secreciones bronquiales, facilitando su expulsión.",
        "indications": "Bronquitis aguda y crónica, traqueobronquitis.",
        "dose_adult": "10 ml (8 mg) tres veces al día.",
        "dose_pediatric": "Niños >12 años: 10 ml (8 mg) 3 veces/día. 6-12 años: 5 ml (4 mg) 3 veces/día. 2-6 años: 2.5 ml (2 mg) 3 veces/día.",
        "contraindications": "Hipersensibilidad, úlcera péptica activa.",
        "minimumAge": "2 años",
        "pregnancy": "Categoría C (FDA) - Evitar 1er Trimestre",
        "lactation": "Riesgo Bajo (Según e-lactancia.org)"
    },
    {
        "name": "Bromuro de Ipratropio",
        "presentation": "Inhalador 20mcg/dosis",
        "family": "Broncodilatador Anticolinérgico (SAMA)",
        "simpleFamily": "Respiratorios",
        "uses": "Tratamiento del broncoespasmo en EPOC.",
        "indications": "Enfermedad Pulmonar Obstructiva Crónica (EPOC), incluyendo bronquitis crónica y enfisema.",
        "dose_adult": "2 inhalaciones (40 mcg) quatro veces al día.",
        "dose_pediatric": "Niños >6 años: 1-2 inhalaciones cada 6-8 horas.",
        "contraindications": "Hipersensibilidad a la atropina o sus derivados, glaucoma de ángulo estrecho, hiperplasia prostática.",
        "minimumAge": "6 años",
        "pregnancy": "Categoría B (FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Bromuro de Otilonio",
        "presentation": "Tabletas 40mg",
        "family": "Antiespasmódico",
        "simpleFamily": "Gastrointestinales",
        "uses": "Alivio de espasmos y dolor en el tracto gastrointestinal.",
        "indications": "Síndrome de intestino irritable, dolor abdominal tipo cólico, espasmos.",
        "dose_adult": "40 mg dos o tres veces al día.",
        "dose_pediatric": "No recomendado.",
        "contraindications": "Hipersensibilidad, obstrucción intestinal.",
        "minimumAge": "18 años",
        "pregnancy": "Categoría C (FDA) - Evitar",
        "lactation": "Riesgo Alto - Evitar (Según Fabricante)"
    },
    {
        "name": "Bromuro de pinaverio",
        "presentation": "Tabletas 100mg",
        "family": "Antagonista de Canales de Calcio (Antiespasmódico)",
        "simpleFamily": "Gastrointestinales",
        "uses": "Tratamiento del síndrome de intestino irritable.",
        "indications": "Dolor abdominal, espasmos, distensión y alteraciones del tránsito intestinal.",
        "dose_adult": "100 mg dos veces al día, antes de las comidas.",
        "dose_pediatric": "No recomendado.",
        "contraindications": "Hipersensibilidad.",
        "minimumAge": "18 años",
        "pregnancy": "Categoría C (FDA) - Evitar",
        "lactation": "Riesgo Alto - Evitar (Según Fabricante)"
    },
    {
        "name": "Budesonida",
        "presentation": "Suspensión para Nebulizar 0.250mg/ml",
        "family": "Corticosteroide Inhalado",
        "simpleFamily": "Respiratorios",
        "uses": "Tratamiento de mantenimiento del asma y crup.",
        "indications": "Asma persistente en pacientes que requieren nebulización, laringotraqueobronquitis aguda (crup).",
        "dose_adult": "Asma: 0.5-1 mg dos veces al día.",
        "dose_pediatric": "Asma (3 meses-12 años): 0.25-0.5 mg dos veces al día. Crup: Dosis única de 2 mg.",
        "contraindications": "Hipersensibilidad, tratamiento primario del estado asmático.",
        "minimumAge": "3 meses",
        "pregnancy": "Categoría B (FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Budesonida",
        "presentation": "Suspensión para Nebulizar 0.500mg/ml",
        "family": "Corticosteroide Inhalado",
        "simpleFamily": "Respiratorios",
        "uses": "Tratamiento de mantenimiento del asma y crup.",
        "indications": "Asma persistente en pacientes que requieren nebulización, laringotraqueobronquitis aguda (crup).",
        "dose_adult": "Asma: 0.5-1 mg dos veces al día.",
        "dose_pediatric": "Asma (3 meses-12 años): 0.25-0.5 mg dos veces al día. Crup: Dosis única de 2 mg.",
        "contraindications": "Hipersensibilidad, tratamiento primario del estado asmático.",
        "minimumAge": "3 meses",
        "pregnancy": "Categoría B (FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Budesonida / Formoterol",
        "presentation": "Inhalador Polvo Seco 160/4.5mcg",
        "family": "Combinación (Corticosteroide + LABA)",
        "simpleFamily": "Respiratorios",
        "uses": "Tratamiento de mantenimiento y de rescate para el asma y EPOC.",
        "indications": "Asma, EPOC.",
        "dose_adult": "Asma: 1-2 inhalaciones una o dos veces al día. EPOC: 2 inhalaciones dos veces al día.",
        "dose_pediatric": "Niños >6 años (Asma): 1-2 inhalaciones una o dos veces al día.",
        "contraindications": "Hipersensibilidad, tratamiento primario de crisis asmática aguda.",
        "minimumAge": "6 años",
        "pregnancy": "Categoría C (FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Butilhioscina",
        "presentation": "Gotas Pediátricas 6.67mg/ml",
        "family": "Antagonista Muscarínico (Antiespasmódico)",
        "simpleFamily": "Gastrointestinales",
        "uses": "Alivio de espasmos del tracto gastrointestinal.",
        "indications": "Dolor tipo cólico abdominal en lactantes y niños.",
        "dose_adult": "No aplica.",
        "dose_pediatric": "0.3-0.6 mg/kg/dosis, cada 6-8 horas.",
        "contraindications": "Miastenia gravis, megacolon, glaucoma de ángulo estrecho.",
        "isCalculable": true,
        "isDrops": true,
        "concentration": 6.67,
        "doseMin_mg_kg_dosis": 0.3,
        "doseMax_mg_kg_dosis": 0.6,
        "doseFreq": 3,
        "minimumAge": "1 mes",
        "pregnancy": "Categoría C (FDA) - Evaluar",
        "lactation": "Riesgo Bajo (Según e-lactancia.org)"
    },
    {
        "name": "Butilhioscina / Ibuprofeno",
        "presentation": "Tabletas 20mg/400mg",
        "family": "Combinación (Antiespasmódico + AINE)",
        "simpleFamily": "Analgésicos",
        "uses": "Alivio del dolor espasmódico.",
        "indications": "Dolor tipo cólico menstrual (dismenorrea), dolor abdominal espasmódico.",
        "dose_adult": "1 tableta cada 8 horas.",
        "dose_pediatric": "No recomendado en menores de 12 años.",
        "contraindications": "Hipersensibilidad a los componentes o AINEs, úlcera péptica, miastenia gravis.",
        "minimumAge": "12 años",
        "pregnancy": "Categoría D (FDA) - Contraindicado",
        "lactation": "Riesgo Alto - Evitar (Según e-lactancia.org)"
    },
    {
        "name": "Butilhioscina / Paracetamol",
        "presentation": "Solución Gotas (6.67mg/333.4mg por ml)",
        "family": "Combinación (Antiespasmódico + Analgésico)",
        "simpleFamily": "Gastrointestinales",
        "uses": "Alivio de cólicos y dolor abdominal.",
        "indications": "Dolor espasmódico del tracto gastrointestinal o genitourinario.",
        "dose_adult": "20-40 gotas cada 6-8 horas.",
        "dose_pediatric": "Niños >6 años: 10-20 gotas cada 8 horas. Lactantes: 5-10 gotas cada 8 horas.",
        "contraindications": "Hipersensibilidad, miastenia gravis, megacolon, insuficiencia hepática.",
        "minimumAge": "3 meses",
        "pregnancy": "Categoría C (FDA) - Evaluar",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Butilhioscina",
        "presentation": "Solución Inyectable 20mg/1ml",
        "family": "Antagonista Muscarínico (Antiespasmódico)",
        "simpleFamily": "Gastrointestinales",
        "uses": "Alivio de espasmos agudos del tracto gastrointestinal, biliar y genitourinario.",
        "indications": "Cólico renal, cólico biliar, espasmos agudos.",
        "dose_adult": "20-40 mg (1-2 ml) por vía IV, IM o SC, varias veces al día (máx. 100 mg/día).",
        "dose_pediatric": "0.3-0.6 mg/kg/dosis, cada 6-8 horas.",
        "contraindications": "Miastenia gravis, megacolon, glaucoma de ángulo estrecho.",
        "minimumAge": "1 mes",
        "pregnancy": "Categoría C (FDA) - Evaluar",
        "lactation": "Riesgo Bajo (Según e-lactancia.org)"
    },
    {
        "name": "Calcio (Gluconato/Carbonato)",
        "presentation": "Comprimidos efervescentes 500mg",
        "family": "Suplemento Mineral",
        "simpleFamily": "Vitaminas y Suplementos",
        "uses": "Prevención y tratamiento de la deficiencia de calcio.",
        "indications": "Osteoporosis, hipocalcemia.",
        "dose_adult": "1-2 comprimidos al día disueltos en agua.",
        "dose_pediatric": "Niños >6 años: 1 comprimido al día.",
        "contraindications": "Hipercalcemia, hipercalciuria, insuficiencia renal grave.",
        "minimumAge": "6 años",
        "pregnancy": "Categoría A (FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Canagliflozina",
        "presentation": "Tabletas 100mg / 300mg",
        "family": "Inhibidor del Cotransportador Sodio-Glucosa 2 (SGLT2)",
        "simpleFamily": "Antidiabéticos",
        "uses": "Control glucémico en diabetes tipo 2.",
        "indications": "Diabetes mellitus tipo 2, reduce riesgo cardiovascular y de nefropatía.",
        "dose_adult": "Inicial: 100 mg una vez al día. Máximo: 300 mg/día.",
        "dose_pediatric": "No recomendado.",
        "contraindications": "Insuficiencia renal grave (TFG < 30), hipersensibilidad.",
        "minimumAge": "18 años",
        "pregnancy": "Categoría C (FDA) - Contraindicado",
        "lactation": "Riesgo Alto - Contraindicado (Según Fabricante)",
        "renalDoseAdjust": { "enabled": true }
    },
    {
        "name": "Candesartán",
        "presentation": "Tabletas 8mg / 16mg / 32mg",
        "family": "Antagonista del Receptor de Angiotensina II (ARA2)",
        "simpleFamily": "Antihipertensivos",
        "uses": "Tratamiento de la hipertensión y la insuficiencia cardíaca.",
        "indications": "Hipertensión arterial, insuficiencia cardíaca con función ventricular sistólica reducida.",
        "dose_adult": "Inicial: 8-16 mg/día. Máximo: 32 mg/día.",
        "dose_pediatric": "Niños 1-17 años (uso por especialista).",
        "contraindications": "Embarazo, insuficiencia hepática severa.",
        "minimumAge": "1 año",
        "pregnancy": "Categoría D (FDA) - Contraindicado",
        "lactation": "Riesgo Alto - Contraindicado (Según e-lactancia.org)"
    },
    {
        "name": "Carbamazepina",
        "presentation": "Tabletas 200mg",
        "family": "Anticonvulsivo (Iminostilbeno)",
        "simpleFamily": "Anticonvulsivos",
        "uses": "Epilepsia, neuralgia del trigémino, trastorno bipolar.",
        "indications": "Crisis epilépticas parciales y tónico-clónicas. Dolor neuropático. Manía.",
        "dose_adult": "Inicial: 100-200mg 1-2 veces/día. Mantenimiento: 800-1200mg/día en dosis divididas.",
        "dose_pediatric": "10-20 mg/kg/día, dividido en 2-4 dosis.",
        "contraindications": "Hipersensibilidad, bloqueo auriculoventricular, antecedentes de depresión de médula ósea.",
        "minimumAge": "Cualquier edad (uso por especialista)",
        "pregnancy": "Categoría D (FDA) - Evitar si es posible",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Carbocisteína",
        "presentation": "Cápsulas / Jarabe",
        "family": "Mucolítico",
        "simpleFamily": "Respiratorios",
        "uses": "Reduce la viscosidad del moco.",
        "indications": "Afecciones respiratorias con moco espeso, como bronquitis y EPOC.",
        "dose_adult": "750 mg tres veces al día, luego reducir.",
        "dose_pediatric": "Niños 2-5 años: 62.5-125 mg 4 veces/día. 6-12 años: 250 mg 3 veces/día.",
        "contraindications": "Úlcera péptica activa, hipersensibilidad.",
        "minimumAge": "2 años",
        "pregnancy": "Categoría C (FDA) - Evitar 1er Trimestre",
        "lactation": "Riesgo Bajo (Según e-lactancia.org)"
    },
    {
        "name": "Captopril",
        "presentation": "Tabletas 25mg",
        "family": "Inhibidor de la Enzima Convertidora de Angiotensina (IECA)",
        "simpleFamily": "Antihipertensivos",
        "uses": "Hipertensión arterial, insuficiencia cardíaca, nefropatía diabética.",
        "indications": "Manejo de la hipertensión, insuficiencia cardíaca, post-infarto de miocardio.",
        "dose_adult": "Inicial: 12.5-25 mg 2-3 veces/día.",
        "dose_pediatric": "0.3-0.5 mg/kg/dosis, cada 8 horas.",
        "contraindications": "Antecedentes de angioedema, embarazo.",
        "minimumAge": "Recién nacido (uso por especialista)",
        "pregnancy": "Categoría D (FDA) - Contraindicado",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Cefaclor",
        "presentation": "Suspensión Oral 375mg/5ml",
        "family": "Cefalosporina de 2ª Generación",
        "simpleFamily": "Antibióticos",
        "uses": "Tratamiento de infecciones bacterianas.",
        "indications": "Otitis media, infecciones del tracto respiratorio, piel y vías urinarias.",
        "dose_adult": "No es la presentación usual.",
        "dose_pediatric": "20-40 mg/kg/día, dividido en 2-3 dosis.",
        "contraindications": "Hipersensibilidad a cefalosporinas.",
        "isCalculable": true,
        "concentration": 75,
        "doseMin_mg_kg_dia": 20,
        "doseMax_mg_kg_dia": 40,
        "doseIntervals": "2-3",
        "minimumAge": "1 mes",
        "pregnancy": "Categoría B (FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Cefalexina",
        "presentation": "Suspensión Oral 250mg/5ml",
        "family": "Cefalosporina de 1ª Generación",
        "simpleFamily": "Antibióticos",
        "uses": "Infecciones bacterianas de piel, tracto respiratorio y urinario.",
        "indications": "Faringitis, otitis media, infecciones de piel y tejidos blandos.",
        "dose_adult": "250-500 mg cada 6 horas.",
        "dose_pediatric": "25-50 mg/kg/día, dividido en 2-4 dosis.",
        "contraindications": "Hipersensibilidad a cefalosporinas.",
        "isCalculable": true,
        "concentration": 50,
        "doseMin_mg_kg_dia": 25,
        "doseMax_mg_kg_dia": 50,
        "doseIntervals": "2-4",
        "minimumAge": "1 mes",
        "pregnancy": "Categoría B (FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Cefalotina",
        "presentation": "Solución Inyectable 1g",
        "family": "Cefalosporina de 1ª Generación",
        "simpleFamily": "Antibióticos",
        "uses": "Tratamiento de infecciones bacterianas graves.",
        "indications": "Infecciones respiratorias, de piel, óseas, septicemia, profilaxis quirúrgica.",
        "dose_adult": "1-2 g cada 4-6 horas IV/IM.",
        "dose_pediatric": "80-160 mg/kg/día, dividido en 4-6 dosis.",
        "contraindications": "Hipersensibilidad a cefalosporinas.",
        "minimumAge": "Recién nacido",
        "pregnancy": "Categoría B (FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Cefixima",
        "presentation": "Tabletas 400mg",
        "family": "Cefalosporina de 3ª Generación",
        "simpleFamily": "Antibióticos",
        "uses": "Tratamiento de infecciones bacterianas.",
        "indications": "Infecciones del tracto urinario, otitis media, faringitis, bronquitis.",
        "dose_adult": "400 mg una vez al día o 200 mg cada 12 horas.",
        "dose_pediatric": "8 mg/kg/día, en una o dos dosis.",
        "contraindications": "Hipersensibilidad a cefalosporinas.",
        "minimumAge": "6 meses",
        "pregnancy": "Categoría B (FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Cefixima",
        "presentation": "Suspensión Oral 100mg/5ml",
        "family": "Cefalosporina de 3ª Generación",
        "simpleFamily": "Antibióticos",
        "uses": "Tratamiento de infecciones bacterianas en niños.",
        "indications": "Infecciones del tracto urinario, otitis media, faringitis, bronquitis.",
        "dose_adult": "No es la presentación usual.",
        "dose_pediatric": "8 mg/kg/día, dividido en una o dos dosis.",
        "contraindications": "Hipersensibilidad a cefalosporinas.",
        "isCalculable": true,
        "concentration": 20,
        "doseMin_mg_kg_dia": 8,
        "doseMax_mg_kg_dia": 8,
        "doseIntervals": "1-2",
        "minimumAge": "6 meses",
        "pregnancy": "Categoría B (FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Cefotaxima",
        "presentation": "Solución Inyectable 1g",
        "family": "Cefalosporina de 3ª Generación",
        "simpleFamily": "Antibióticos",
        "uses": "Tratamiento de infecciones bacterianas graves.",
        "indications": "Meningitis, neumonía, septicemia, infecciones abdominales, ginecológicas.",
        "dose_adult": "1-2 g cada 6-8 horas IV/IM.",
        "dose_pediatric": "50-180 mg/kg/día, dividido en 4-6 dosis.",
        "contraindications": "Hipersensibilidad a cefalosporinas.",
        "minimumAge": "Recién nacido",
        "pregnancy": "Categoría B (FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Ceftazidima",
        "presentation": "Solución Inyectable 1g",
        "family": "Cefalosporina de 3ª Generación",
        "simpleFamily": "Antibióticos",
        "uses": "Tratamiento de infecciones bacterianas, especialmente por Pseudomonas.",
        "indications": "Neumonía nosocomial, infecciones en pacientes neutropénicos, meningitis.",
        "dose_adult": "1-2 g cada 8-12 horas IV/IM.",
        "dose_pediatric": "100-150 mg/kg/día, dividido en 3 dosis.",
        "contraindications": "Hipersensibilidad a cefalosporinas.",
        "minimumAge": "Recién nacido",
        "pregnancy": "Categoría B (FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Ceftriaxona",
        "presentation": "Solución Inyectable 500mg / 1g",
        "family": "Cefalosporina de 3ª Generación",
        "simpleFamily": "Antibióticos",
        "uses": "Tratamiento de infecciones bacterianas moderadas a graves.",
        "indications": "Neumonía, meningitis, infecciones de piel, huesos, articulaciones, gonorrea.",
        "dose_adult": "1-2 g una vez al día IV/IM.",
        "dose_pediatric": "50-75 mg/kg/día, en una o dos dosis.",
        "contraindications": "Hipersensibilidad, neonatos con ictericia o que reciben calcio IV.",
        "minimumAge": "Recién nacido",
        "pregnancy": "Categoría B (FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Cefuroxima",
        "presentation": "Tabletas 250mg / 500mg",
        "family": "Cefalosporina de 2ª Generación",
        "simpleFamily": "Antibióticos",
        "uses": "Tratamiento de infecciones bacterianas.",
        "indications": "Faringitis, sinusitis, bronquitis, infecciones de piel, enfermedad de Lyme temprana.",
        "dose_adult": "250-500 mg dos veces al día.",
        "dose_pediatric": "20-30 mg/kg/día, dividido en 2 dosis.",
        "contraindications": "Hipersensibilidad a cefalosporinas.",
        "minimumAge": "3 meses",
        "pregnancy": "Categoría B (FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Cefuroxima",
        "presentation": "Suspensión Oral 125mg/5ml / 250mg/5ml",
        "family": "Cefalosporina de 2ª Generación",
        "simpleFamily": "Antibióticos",
        "uses": "Tratamiento de infecciones bacterianas en niños.",
        "indications": "Otitis media, faringitis, sinusitis.",
        "dose_adult": "No es la presentación usual.",
        "dose_pediatric": "20-30 mg/kg/día, dividido en 2 dosis.",
        "contraindications": "Hipersensibilidad a cefalosporinas.",
        "isCalculable": true,
        "concentration": 25,
        "doseMin_mg_kg_dia": 20,
        "doseMax_mg_kg_dia": 30,
        "doseIntervals": "2",
        "minimumAge": "3 meses",
        "pregnancy": "Categoría B (FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Celecoxib",
        "presentation": "Cápsulas 200 mg",
        "family": "AINE (Inhibidor selectivo de la COX-2)",
        "simpleFamily": "Antiinflamatorios",
        "uses": "Alivio del dolor y la inflamación.",
        "indications": "Osteoartritis, artritis reumatoide, espondilitis anquilosante, dolor agudo, dismenorrea.",
        "dose_adult": "200 mg una vez al día o 100 mg dos veces al día.",
        "dose_pediatric": "No recomendado en menores de 18 años.",
        "contraindications": "Hipersensibilidad a AINEs o sulfonamidas, úlcera péptica activa, insuficiencia cardíaca grave.",
        "minimumAge": "18 años",
        "pregnancy": "Categoría D (FDA) - Contraindicado en 3er trimestre",
        "lactation": "Riesgo Bajo (Según e-lactancia.org)"
    },
    {
        "name": "Cilostazol",
        "presentation": "Tabletas 100mg",
        "family": "Inhibidor de la Fosfodiesterasa III",
        "simpleFamily": "Cardiovasculares",
        "uses": "Mejora los síntomas de la claudicación intermitente.",
        "indications": "Claudicación intermitente (dolor en las piernas al caminar debido a mala circulación).",
        "dose_adult": "100 mg dos veces al día.",
        "dose_pediatric": "Seguridad y eficacia no establecidas.",
        "contraindications": "Insuficiencia cardíaca congestiva de cualquier grado, hipersensibilidad.",
        "minimumAge": "18 años",
        "pregnancy": "Categoría C (FDA) - Evaluar",
        "lactation": "Riesgo Alto - Evitar (Según e-lactancia.org)"
    },
    {
        "name": "Cinitaprida",
        "presentation": "Tabletas 1mg",
        "family": "Procinético (Benzamida)",
        "simpleFamily": "Gastrointestinales",
        "uses": "Mejora el vaciamiento gástrico y el tránsito intestinal.",
        "indications": "Trastornos de la motilidad gastrointestinal, reflujo gastroesofágico, dispepsia funcional.",
        "dose_adult": "1 mg tres veces al día, 15 minutos antes de cada comida.",
        "dose_pediatric": "No se recomienda su uso en niños y adolescentes.",
        "contraindications": "Hipersensibilidad, hemorragia, obstrucción o perforación gastrointestinal, antecedentes de discinesia tardía por neurolépticos.",
        "minimumAge": "18 años",
        "pregnancy": "Categoría C (FDA) - Evitar",
        "lactation": "Riesgo Alto - Evitar (Según e-lactancia.org)"
    },
    {
        "name": "Ciprofloxacino",
        "presentation": "Solución Oftálmica",
        "family": "Fluoroquinolona (Tópico)",
        "simpleFamily": "Oftalmológicos",
        "uses": "Tratamiento de infecciones oculares bacterianas.",
        "indications": "Conjuntivitis bacteriana, úlceras corneales.",
        "dose_adult": "1-2 gotas cada 2-4 horas, según la gravedad.",
        "dose_pediatric": "Niños >1 año: Misma dosis que adultos.",
        "contraindications": "Hipersensibilidad a quinolonas.",
        "minimumAge": "1 año",
        "pregnancy": "Categoría C (FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Citalopram",
        "presentation": "Tabletas 20mg",
        "family": "Inhibidor Selectivo de la Recaptura de Serotonina (ISRS)",
        "simpleFamily": "Antidepresivos",
        "uses": "Tratamiento de la depresión y trastornos de ansiedad.",
        "indications": "Trastorno depresivo mayor, trastorno de pánico, trastorno de ansiedad social.",
        "dose_adult": "Inicial: 20 mg/día. Máximo: 40 mg/día.",
        "dose_pediatric": "No aprobado para menores de 18 años.",
        "contraindications": "Uso concomitante con IMAO, hipersensibilidad, prolongación del intervalo QT.",
        "minimumAge": "18 años",
        "pregnancy": "Categoría C (FDA) - Evaluar",
        "lactation": "Riesgo Bajo (Según e-lactancia.org)"
    },
    {
        "name": "Cetirizina",
        "presentation": "Gotas Pediátricas 10mg/ml",
        "family": "Antihistamínico H1 de 2ª Generación",
        "simpleFamily": "Antialérgicos",
        "uses": "Alivio de síntomas de alergias.",
        "indications": "Rinitis alérgica, urticaria crónica idiopática.",
        "dose_adult": "No aplica.",
        "dose_pediatric": "6-12 meses: 2.5 mg (5 gotas) una vez al día. 1-2 años: 2.5 mg (5 gotas) dos veces al día. 2-6 años: 5 mg (10 gotas) una vez al día o 2.5 mg (5 gotas) dos veces al día.",
        "contraindications": "Hipersensibilidad, insuficiencia renal grave.",
        "minimumAge": "6 meses",
        "pregnancy": "Categoría B (FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Cetirizina",
        "presentation": "Solución 100mg/100ml (1mg/ml)",
        "family": "Antihistamínico H1 de 2ª Generación",
        "simpleFamily": "Antialérgicos",
        "uses": "Alivio de síntomas de alergias.",
        "indications": "Rinitis alérgica, urticaria crónica.",
        "dose_adult": "5-10 mg (5-10 ml) una vez al día.",
        "dose_pediatric": "2-5 años: 2.5-5 mg (2.5-5 ml) una vez al día. >6 años: 5-10 mg (5-10 ml) una vez al día.",
        "contraindications": "Hipersensibilidad.",
        "minimumAge": "2 años",
        "pregnancy": "Categoría B (FDA) - Seguro",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Cinarizina",
        "presentation": "Tabletas 25mg",
        "family": "Antihistamínico H1 (Piperazina)",
        "simpleFamily": "Antialérgicos",
        "uses": "Tratamiento del vértigo, mareo y trastornos del equilibrio.",
        "indications": "Vértigo, enfermedad de Ménière, profilaxis de la cinetosis.",
        "dose_adult": "25 mg tres veces al día.",
        "dose_pediatric": "No recomendado en niños.",
        "contraindications": "Hipersensibilidad, enfermedad de Parkinson.",
        "minimumAge": "12 años",
        "pregnancy": "Categoría C (FDA) - Evitar",
        "lactation": "Riesgo Alto - Evitar (Según e-lactancia.org)"
    },
    {
        "name": "Cinarizina",
        "presentation": "Tabletas 75mg",
        "family": "Antihistamínico H1 (Piperazina)",
        "simpleFamily": "Antialérgicos",
        "uses": "Tratamiento del vértigo, mareo y trastornos del equilibrio.",
        "indications": "Vértigo, enfermedad de Ménière, profilaxis de la cinetosis.",
        "dose_adult": "75 mg una vez al día.",
        "dose_pediatric": "No recomendado en niños.",
        "contraindications": "Hipersensibilidad, enfermedad de Parkinson.",
        "minimumAge": "12 años",
        "pregnancy": "Categoría C (FDA) - Evitar",
        "lactation": "Riesgo Alto - Evitar (Según e-lactancia.org)"
    },
    {
        "name": "Ciprofloxacino",
        "presentation": "Tabletas 500mg",
        "family": "Fluoroquinolona (Antibiótico)",
        "simpleFamily": "Antibióticos",
        "uses": "Infecciones bacterianas complicadas.",
        "indications": "Infecciones del tracto urinario complicadas, infecciones gastrointestinales, infecciones óseas y articulares.",
        "dose_adult": "500-750 mg dos veces al día.",
        "dose_pediatric": "20-30 mg/kg/día, dividido en 2 dosis.",
        "contraindications": "Hipersensibilidad a quinolonas, uso concomitante con tizanidina.",
        "minimumAge": "1 año (uso restringido)",
        "pregnancy": "Categoría C (FDA) - Evitar",
        "lactation": "Riesgo Bajo (Según e-lactancia.org)"
    },
    {
        "name": "Cisaprida",
        "presentation": "Tabletas 10mg",
        "family": "Procinético",
        "simpleFamily": "Gastrointestinales",
        "uses": "Mejora la motilidad gastrointestinal.",
        "indications": "Gastroparesia, reflujo gastroesofágico (uso restringido).",
        "dose_adult": "5-10 mg tres veces al día.",
        "dose_pediatric": "No recomendado.",
        "contraindications": "Riesgo de arritmias cardíacas (prolongación QT), uso con inhibidores de CYP3A4.",
        "minimumAge": "18 años",
        "pregnancy": "Categoría C (FDA) - Evitar",
        "lactation": "Riesgo Alto - Evitar (Según e-lactancia.org)"
    },
    {
        "name": "Claritromicina",
        "presentation": "Tabletas 250mg / 500mg",
        "family": "Macrólido (Antibiótico)",
        "simpleFamily": "Antibióticos",
        "uses": "Infecciones bacterianas respiratorias y de piel.",
        "indications": "Faringitis, sinusitis, bronquitis, neumonía, infecciones por H. pylori.",
        "dose_adult": "250-500 mg cada 12 horas.",
        "dose_pediatric": "Niños >12 meses: 15 mg/kg/día, dividido en 2 dosis.",
        "contraindications": "Hipersensibilidad a macrólidos, uso con cisaprida, pimozida, astemizol.",
        "minimumAge": "12 meses",
        "pregnancy": "Categoría C (Según FDA)",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Clindamicina / Ketoconazol",
        "presentation": "Óvulos 100mg/400mg",
        "family": "Combinación (Antibiótico + Antifúngico)",
        "simpleFamily": "Ginecológicos",
        "uses": "Tratamiento de infecciones vaginales mixtas.",
        "indications": "Vaginosis bacteriana, candidiasis vaginal y vaginitis mixtas.",
        "dose_adult": "1 óvulo por vía vaginal profunda, una vez al día, por la noche, durante 7 días.",
        "dose_pediatric": "No indicado.",
        "contraindications": "Hipersensibilidad a los componentes, antecedentes de colitis asociada a antibióticos.",
        "minimumAge": "Post-menarquia",
        "pregnancy": "Categoría B (FDA) - Clindamicina / Categoría C (FDA) - Ketoconazol",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    },
    {
        "name": "Clonixinato de lisina",
        "presentation": "Solución Inyectable 100mg/2ml",
        "family": "Analgésico no Esteroideo (AINE)",
        "simpleFamily": "Analgésicos",
        "uses": "Alivio del dolor moderado a severo.",
        "indications": "Dolor postoperatorio, cólico renal, dolor oncológico, traumatismos.",
        "dose_adult": "100-200 mg (1-2 ampolletas) vía IM o IV lenta, cada 6-8 horas.",
        "dose_pediatric": "No se recomienda de forma rutinaria.",
        "contraindications": "Hipersensibilidad, úlcera péptica activa, embarazo, insuficiencia renal/hepática severa.",
        "minimumAge": "12 años",
        "pregnancy": "Categoría D (Según FDA) - Contraindicado",
        "lactation": "Riesgo Bajo (Según e-lactancia.org)"
    },
    {
        "name": "Clioquinol",
        "presentation": "Crema 3g",
        "family": "Hidroxiquinolina Tópica (Antifúngico/Antibacteriano)",
        "simpleFamily": "Dermatológicos",
        "uses": "Infecciones cutáneas.",
        "indications": "Dermatitis infectadas, pie de atleta, tiña.",
        "dose_adult": "Aplicar una capa delgada en el área afectada 2-3 veces al día.",
        "dose_pediatric": "Niños >2 años: Misma dosis que adultos.",
        "contraindications": "Hipersensibilidad al clioquinol o al yodo, niños menores de 2 años.",
        "minimumAge": "2 años",
        "pregnancy": "Categoría C (Según FDA)",
        "lactation": "Riesgo Moderado - Usar con precaución (Según e-lactancia.org)"
    },
    {
        "name": "Clopidogrel",
        "presentation": "Tabletas 75 mg",
        "family": "Antiagregante plaquetario",
        "simpleFamily": "Anticoagulantes",
        "uses": "Prevención de eventos aterotrombóticos.",
        "indications": "Prevención de infarto de miocardio, ictus y enfermedad arterial periférica en pacientes con antecedentes.",
        "dose_adult": "75 mg una vez al día.",
        "dose_pediatric": "No recomendado.",
        "contraindications": "Sangrado activo, insuficiencia hepática grave, hipersensibilidad.",
        "minimumAge": "18 años",
        "pregnancy": "Categoría B (Según FDA)",
        "lactation": "Riesgo Muy Bajo - Seguro (Según e-lactancia.org)"
    }
];

    // --- TEMAS CLÍNICOS (Contenido estático) ---
    const clinicalThemes = {
        'dm2-inicio': {
            name: 'Manejo Inicial de Diabetes Mellitus Tipo 2',
            content: `<h2>Manejo Inicial de Diabetes Mellitus Tipo 2</h2><p>Esta guía resume el enfoque inicial para un paciente recién diagnosticado con Diabetes Mellitus tipo 2 (DM2), basado en guías clínicas comunes.</p><h3>Paso 1: Diagnóstico y Metas Iniciales</h3><p>El diagnóstico se confirma con HbA1c ≥ 6.5%, Glucosa en ayuno ≥ 126 mg/dL, o Glucosa a las 2h post-carga ≥ 200 mg/dL. La meta inicial de <strong>HbA1c</strong> es generalmente <strong>< 7%</strong>.</p><h3>Paso 2: Tratamiento No Farmacológico</h3><p>Es la piedra angular del manejo e incluye:</p><ul><li><strong>Educación sobre la enfermedad:</strong> Automonitoreo, reconocimiento de hipo/hiperglucemia.</li><li><strong>Plan de alimentación:</strong> Reducción de carbohidratos simples y grasas saturadas.</li><li><strong>Actividad física:</strong> Mínimo 150 minutos de ejercicio aeróbico moderado a la semana.</li><li><strong>Pérdida de peso:</strong> Objetivo inicial del 5-10% del peso corporal.</li></ul><h3>Paso 3: Tratamiento Farmacológico de Primera Línea</h3><p>A menos que existan contraindicaciones, el tratamiento de elección para iniciar es:</p><ul><li><strong><a href="#" class="med-link" data-med-name="Metformina">Metformina</a>:</strong> Iniciar con 500-850 mg una o dos veces al día con los alimentos para minimizar efectos gastrointestinales. Incrementar gradualmente cada 1-2 semanas hasta una dosis objetivo de 2000 mg/día.</li></ul><h3>Paso 4: Terapia Dual (Si no se alcanzan metas en 3 meses)</h3><p>Si la HbA1c sigue por encima de la meta después de 3 meses de monoterapia con Metformina, se debe añadir un segundo agente.</p><h4><strong>Si existe enfermedad cardiovascular (ASCVD), insuficiencia cardíaca (IC) o enfermedad renal (ERC):</strong></h4><ul><li>Añadir un <strong>agonista del receptor de GLP-1</strong> (ej. <a href="#" class="med-link" data-med-name="Liraglutida">Liraglutida</a>) o un <strong>inhibidor de SGLT2</strong> (ej. <a href="#" class="med-link" data-med-name="Dapagliflozina">Dapagliflozina</a>).</li></ul><h4><strong>Para minimizar hipoglucemia:</strong></h4><ul><li>Añadir un <strong>inhibidor de DPP-4</strong> (ej. <a href="#" class="med-link" data-med-name="Sitagliptina">Sitagliptina</a>), un agonista de GLP-1, un inhibidor de SGLT2, o una <strong>Tiazolidinediona (TZD)</strong> (ej. <a href="#" class="med-link" data-med-name="Pioglitazona">Pioglitazona</a>).</li></ul><h4><strong>Para promover pérdida de peso:</strong></h4><ul><li>Añadir un <strong>agonista de GLP-1</strong> o un <strong>inhibidor de SGLT2</strong>.</li></ul><h4><strong>Si el costo es una barrera:</strong></h4><ul><li>Añadir una <strong>sulfonilurea</strong> (ej. <a href="#" class="med-link" data-med-name="Glibenclamida">Glibenclamida</a>) o una TZD.</li></ul><div class="bibliografia"><h4>Referencias</h4><p>Adaptado de: ADA. Standards of Medical Care in Diabetes—2023. Diabetes Care 2023;46(Suppl. 1):S140–S157.</p></div>`
        },
        'crisis-hipertensivas': {
            name: 'Manejo de Crisis Hipertensivas',
            content: `<h2>Manejo de Crisis Hipertensivas</h2><p>Una crisis hipertensiva se define como una elevación severa de la presión arterial (PA), generalmente >180/120 mmHg. Se clasifica en urgencia o emergencia según la presencia de daño a órgano blanco.</p><h3>1. Urgencia Hipertensiva</h3><p><strong>Definición:</strong> Elevación severa de la PA <strong>sin</strong> evidencia de daño agudo a órgano blanco (cerebro, corazón, riñón, retina).</p><p><strong>Manejo:</strong> El objetivo es reducir la PA gradualmente en 24-48 horas utilizando medicamentos orales. Una reducción demasiado rápida puede causar isquemia.</p><ul><li><strong>Tratamiento de elección:</strong> Reiniciar o ajustar el tratamiento antipertensivo del paciente.</li><li><strong>Fármacos orales comúnmente usados:</strong><ul><li><strong><a href="#" class="med-link" data-med-name="Captopril">Captopril</a>:</strong> 25 mg vía oral. Es un IECA de acción rápida.</li><li><strong><a href="#" class="med-link" data-med-name="Nifedipino">Nifedipino</a> de liberación prolongada:</strong> 30-60 mg. <strong>NUNCA usar nifedipino sublingual de acción corta</strong> por el riesgo de caídas bruscas de la PA.</li></ul></li></ul><h3>2. Emergencia Hipertensiva</h3><p><strong>Definición:</strong> Elevación severa de la PA <strong>con</strong> evidencia de daño agudo y progresivo a órgano blanco. Requiere hospitalización y tratamiento intravenoso inmediato.</p><p><strong>Manejo:</strong> El objetivo es reducir la Presión Arterial Media (PAM) en un 10-20% en la primera hora, y otro 5-15% en las siguientes 23 horas.</p><ul><li><strong>Encefalopatía Hipertensiva:</strong> Reducción inmediata de la PAM en 20-25%. Fármaco de elección: <strong><a href="#" class="med-link" data-med-name="Labetalol">Labetalol</a></strong> o <strong><a href="#" class="med-link" data-med-name="Nitroprusiato de Sodio">Nitroprusiato</a></strong>.</li><li><strong>Accidente Cerebrovascular (EVC) Isquémico:</strong> No se recomienda bajar la PA a menos que sea >220/120 mmHg (o >185/110 si es candidato a trombólisis).</li><li><strong>Disección Aórtica:</strong> Reducción rápida de la PA sistólica a <120 mmHg. Fármaco de elección: Betabloqueadores como <strong><a href="#" class="med-link" data-med-name="Labetalol">Labetalol</a></strong>.</li><li><strong>Edema Agudo de Pulmón Cardiogénico:</strong> Vasodilatadores y diuréticos de asa como <strong><a href="#" class="med-link" data-med-name="Furosemida">Furosemida</a></strong>.</li></ul><div class="bibliografia"><h4>Referencias</h4><p>Adaptado de: Whelton PK, et al. 2017 ACC/AHA/AAPA/ABC/ACPM/AGS/APhA/ASH/ASPC/NMA/PCNA Guideline for the Prevention, Detection, Evaluation, and Management of High Blood Pressure in Adults.</p></div>`
        }
    };

    // --- ESTADO GLOBAL DE LA APLICACIÓN ---
    const state = {
        medications: { all: [], uniqueFamilies: [], uniquePresentations: [] },
        favorites: new Set(),
        ui: {
            view: 'medications',
            activeFamily: 'Todos',
            activeThemeId: null,
            searchTerm: '',
            advancedFilters: {},
            patientProfile: new Set(),
        },
        searchHistory: [],
        lazyLoadObserver: null,
    };

    // --- SELECTORES DEL DOM (Cache para rendimiento) ---
    const selectors = {
        medicationSection: document.getElementById('medication-section'),
        themesSection: document.getElementById('themes-section'),
        interactionSection: document.getElementById('interaction-section'),
        medicationList: document.getElementById('medication-list'),
        searchBar: document.getElementById('searchBar'),
        noResults: document.getElementById('no-results'),
        familyFilterContainer: document.getElementById('familyFilterContainer'),
        themesFilterContainer: document.getElementById('themesFilterContainer'),
        favoritesBtn: document.getElementById('favorites-btn'),
        interactionCheckerBtn: document.getElementById('interaction-checker-btn'),
        familiesDropdownBtn: document.getElementById('families-dropdown-btn'),
        themesDropdownBtn: document.getElementById('themes-dropdown-btn'),
        familiesDropdownPanel: document.getElementById('families-dropdown-panel'),
        themesDropdownPanel: document.getElementById('themes-dropdown-panel'),
        modal: document.getElementById('medicationModal'),
        modalContent: document.getElementById('modal-content-wrapper'),
        cardTemplate: document.getElementById('medication-card-template'),
        medCount: document.getElementById('med-count'),
        skeletonLoader: document.getElementById('skeleton-loader'),
        searchHistoryDatalist: document.getElementById('search-history'),
        familiesBtnText: document.getElementById('families-btn-text'),
        toast: document.getElementById('toast-notification'),
        toastMessage: document.getElementById('toast-message'),
        advancedFilterBtn: document.getElementById('advanced-filter-btn'),
        advancedFilterPanel: document.getElementById('advanced-filter-panel'),
        advancedFilterCount: document.getElementById('advanced-filter-count'),
        patientProfileControls: document.getElementById('patient-profile-controls'),
    };
    
    // --- DECLARACIÓN DE FUNCIONES ---

    const normalizeText = (str = '') => str ? str.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "") : "";
    const debounce = (func, delay = 300) => {
        let timeout;
        return (...args) => {
            clearTimeout(timeout);
            timeout = setTimeout(() => { func.apply(this, args); }, delay);
        };
    };
    function showToast(message) {
        selectors.toastMessage.textContent = message;
        selectors.toast.classList.add('opacity-100', 'translate-y-0');
        selectors.toast.classList.remove('opacity-0', 'translate-y-3');
        setTimeout(() => {
            selectors.toast.classList.remove('opacity-100', 'translate-y-0');
            selectors.toast.classList.add('opacity-0', 'translate-y-3');
        }, 2500);
    }
    function loadStateFromStorage() {
        try {
            const favs = localStorage.getItem('medFavorites');
            if (favs) state.favorites = new Set(JSON.parse(favs));
            const history = localStorage.getItem('medSearchHistory');
            if (history) state.searchHistory = JSON.parse(history);
            updateSearchHistoryDatalist();
        } catch (error) { console.error("Error cargando estado:", error); localStorage.clear(); }
    }
    function saveFavorites() { localStorage.setItem('medFavorites', JSON.stringify(Array.from(state.favorites))); }
    function saveSearchHistory() { localStorage.setItem('medSearchHistory', JSON.stringify(state.searchHistory)); updateSearchHistoryDatalist(); }
    function updateSearchHistoryDatalist() { selectors.searchHistoryDatalist.innerHTML = state.searchHistory.map(term => `<option value="${term}"></option>`).join(''); }
    function toggleFavorite(medId, button) {
        if (state.favorites.has(medId)) { state.favorites.delete(medId); button.classList.remove('is-favorite'); showToast('Eliminado de favoritos'); }
        else { state.favorites.add(medId); button.classList.add('is-favorite'); showToast('Añadido a favoritos'); }
        saveFavorites();
        if (state.ui.view === 'favorites') updateDisplay();
    }
    function applyFiltersAndSearch() {
        const searchTerm = normalizeText(state.ui.searchTerm);
        let results = [...state.medications.all];
        if (state.ui.view === 'favorites') { results = results.filter(med => state.favorites.has(med.originalIndex)); }
        if (searchTerm) {
            results = results.filter(med => 
                normalizeText(med.name).includes(searchTerm) ||
                normalizeText(med.family).includes(searchTerm) ||
                normalizeText(med.uses).includes(searchTerm)
            );
        } else if (Object.keys(state.ui.advancedFilters).length > 0) {
            results = results.filter(med => {
                return Object.entries(state.ui.advancedFilters).every(([key, values]) => {
                    if (!values || values.length === 0) return true;
                    if (key === 'families') return values.includes(med.simpleFamily);
                    if (key === 'presentations') return values.some(p => normalizeText(med.presentation).includes(normalizeText(p).replace(/s\b/, '')));
                    if (key === 'renalDoseAdjust') return values.includes('true') && med.renalDoseAdjust?.enabled;
                    if (key === 'pregnancySafe') return values.includes('true') && (med.pregnancy?.toLowerCase().includes('seguro') || med.pregnancy?.toLowerCase().includes('categoría a'));
                    if (key === 'lactationSafe') return values.includes('true') && med.lactation?.toLowerCase().includes('seguro');
                    return true;
                });
            });
        } else if (state.ui.activeFamily !== 'Todos') {
            results = results.filter(med => med.simpleFamily === state.ui.activeFamily);
        }
        return results;
    }
    function setView(view, id = null) {
        state.ui.view = view;
        state.ui.searchTerm = '';
        selectors.searchBar.value = '';
        document.querySelectorAll('.filter-btn.active, .theme-btn.active').forEach(b => b.classList.remove('active'));
        selectors.favoritesBtn.classList.toggle('active', view === 'favorites');
        selectors.interactionCheckerBtn.classList.toggle('active', view === 'interaction-checker');
        if (view === 'themes') { state.ui.activeThemeId = id; document.querySelector(`.theme-btn[data-theme-id="${id}"]`)?.classList.add('active'); }
        else if (view === 'medications') { document.querySelector('.filter-btn[data-family="Todos"]')?.classList.add('active'); state.ui.activeFamily = 'Todos'; selectors.familiesBtnText.textContent = 'Familias'; }
        updateDisplay();
    }
    const updateDisplay = debounce(() => {
        const isMedView = ['medications', 'favorites'].includes(state.ui.view);
        selectors.medicationSection.classList.toggle('hidden', !isMedView);
        selectors.themesSection.classList.toggle('hidden', state.ui.view !== 'themes');
        selectors.interactionSection.classList.toggle('hidden', state.ui.view !== 'interaction-checker');
        if (state.ui.view === 'interaction-checker') renderInteractionChecker();
        else if (isMedView) renderMedications(applyFiltersAndSearch());
        else if (state.ui.view === 'themes') renderTheme(state.ui.activeThemeId);
    });
    function renderInteractionChecker() {
        selectors.interactionSection.innerHTML = `
            <div class="interaction-checker-container">
                <div class="interaction-header"><h2>Verificador de Interacciones</h2><p>Seleccione dos o más medicamentos para verificar.</p></div>
                <div class="interaction-body">
                    <div>
                        <div class="interaction-selection-controls">
                            <input type="text" id="interaction-search" class="interaction-search-bar" placeholder="Filtrar medicamentos...">
                            <div class="interaction-selection-info"><span id="selection-count">0 seleccionados</span><button id="clear-selection" class="clear-selection-btn">Limpiar</button></div>
                        </div>
                        <div class="med-selection-list">${state.medications.all.map(med => `<button class="interaction-med-btn" data-med-name="${med.name}">${med.name}</button>`).join('')}</div>
                    </div>
                    <div class="interaction-results"><h3>Resultados</h3><div id="interaction-results-content"><p class="text-slate-500">Seleccione medicamentos.</p></div></div>
                </div>
            </div>`;
        const medButtons = Array.from(selectors.interactionSection.querySelectorAll('.interaction-med-btn'));
        const resultsContent = document.getElementById('interaction-results-content');
        const searchInput = document.getElementById('interaction-search');
        const selectionCount = document.getElementById('selection-count');
        const clearButton = document.getElementById('clear-selection');
        let selectedMeds = [];
        const updateSelectionCount = () => { selectionCount.textContent = `${selectedMeds.length} seleccionados`; };
        const handleSelection = (btn) => {
            btn.classList.toggle('selected');
            const medName = btn.dataset.medName;
            const index = selectedMeds.indexOf(medName);
            (index > -1) ? selectedMeds.splice(index, 1) : selectedMeds.push(medName);
            updateSelectionCount();
            checkInteractions(selectedMeds, resultsContent);
        };
        medButtons.forEach(btn => btn.addEventListener('click', () => handleSelection(btn)));
        searchInput.addEventListener('input', debounce((e) => {
            const term = normalizeText(e.target.value);
            medButtons.forEach(btn => { btn.style.display = normalizeText(btn.dataset.medName).includes(term) ? '' : 'none'; });
        }));
        clearButton.addEventListener('click', () => {
            selectedMeds = [];
            medButtons.forEach(btn => btn.classList.remove('selected'));
            updateSelectionCount();
            checkInteractions(selectedMeds, resultsContent);
        });
    }
    function checkInteractions(selectedMedNames, resultsContent) {
        if (selectedMedNames.length < 2) { resultsContent.innerHTML = '<p class="text-slate-500">Seleccione al menos dos medicamentos.</p>'; return; }
        const interactions = new Set();
        const selectedMeds = state.medications.all.filter(med => selectedMedNames.includes(med.name));
        for (let i = 0; i < selectedMeds.length; i++) {
            for (let j = i + 1; j < selectedMeds.length; j++) {
                const med1 = selectedMeds[i], med2 = selectedMeds[j];
                if (med1.interactions) {
                    for (const level in med1.interactions) {
                        med1.interactions[level].forEach(desc => { if (normalizeText(desc).includes(normalizeText(med2.name))) interactions.add(JSON.stringify({ meds: [med1.name, med2.name].sort(), level, description: desc })); });
                    }
                }
                if (med2.interactions) {
                    for (const level in med2.interactions) {
                        med2.interactions[level].forEach(desc => { if (normalizeText(desc).includes(normalizeText(med1.name))) interactions.add(JSON.stringify({ meds: [med2.name, med1.name].sort(), level, description: desc })); });
                    }
                }
            }
        }
        const uniqueInteractions = Array.from(interactions).map(item => JSON.parse(item));
        if (uniqueInteractions.length === 0) { resultsContent.innerHTML = '<div class="info-box-success"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg><p>No se encontraron interacciones conocidas.</p></div>'; }
        else { resultsContent.innerHTML = uniqueInteractions.map(int => `<div class="interaction-item"><p><strong>${int.meds[0]} + ${int.meds[1]}</strong></p><p class="level-${int.level}">${int.level.charAt(0).toUpperCase() + int.level.slice(1)}: ${int.description}</p></div>`).join(''); }
    }
    function renderMedications(meds) {
        selectors.skeletonLoader.classList.add('hidden');
        selectors.medicationList.classList.remove('hidden');
        selectors.medicationList.innerHTML = '';
        selectors.noResults.classList.toggle('hidden', meds.length > 0);
        const fragment = document.createDocumentFragment();
        meds.forEach(med => { fragment.appendChild(createMedicationCard(med)); });
        selectors.medicationList.appendChild(fragment);
        setupLazyLoading();
    }
    function setupLazyLoading() {
        if (state.lazyLoadObserver) state.lazyLoadObserver.disconnect();
        state.lazyLoadObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    img.src = img.dataset.src;
                    img.classList.remove('lazy');
                    observer.unobserve(img);
                }
            });
        }, { rootMargin: "0px 0px 200px 0px" });
        document.querySelectorAll('.card-img.lazy').forEach(img => state.lazyLoadObserver.observe(img));
    }
    function createMedicationCard(med) {
        const cardClone = selectors.cardTemplate.content.cloneNode(true);
        const cardElement = cardClone.querySelector('.medication-card');
        const favButton = cardClone.querySelector('.favorite-btn-card');
        const imgElement = cardClone.querySelector('.card-img');
        const warningIcon = cardClone.querySelector('#card-warning-icon');
        const imgText = `${med.name} / ${med.presentation}`;
        cardClone.querySelector('.card-name').textContent = med.name;
        cardClone.querySelector('.card-presentation').textContent = med.presentation;
        cardClone.querySelector('.card-family').textContent = med.family;
        cardClone.querySelector('.card-uses').textContent = med.uses;
        imgElement.dataset.src = med.imageUrl || `https://placehold.co/400x200/e0f2fe/083344?text=${encodeURIComponent(imgText)}`;
        imgElement.alt = `Imagen de ${med.name}`;
        if (state.favorites.has(med.originalIndex)) { favButton.classList.add('is-favorite'); }
        const profile = state.ui.patientProfile;
        let hasWarning = false;
        if (profile.has('renal') && med.renalDoseAdjust?.enabled) hasWarning = true;
        if (profile.has('pregnancy') && med.pregnancy && !med.pregnancy.toLowerCase().includes('seguro')) hasWarning = true;
        if (profile.has('lactation') && med.lactation && !med.lactation.toLowerCase().includes('seguro')) hasWarning = true;
        if (hasWarning) { warningIcon.classList.remove('hidden'); }
        favButton.addEventListener('click', (e) => { e.stopPropagation(); toggleFavorite(med.originalIndex, favButton); });
        cardElement.addEventListener('click', () => openModal(med));
        return cardClone;
    }
    function renderTheme(themeId) {
        const theme = clinicalThemes[themeId];
        selectors.themesSection.innerHTML = (theme && theme.content) ? theme.content : `<p class="text-center p-8">Contenido no encontrado.</p>`;
        if (theme) {
            selectors.themesSection.querySelectorAll('.med-link').forEach(link => {
                link.addEventListener('click', e => {
                    e.preventDefault();
                    const med = state.medications.all.find(m => normalizeText(m.name) === normalizeText(e.target.dataset.medName));
                    if (med) openModal(med);
                });
            });
        }
    }

    function openModal(med) {
        const isFavorite = state.favorites.has(med.originalIndex);
        const imgText = `${med.name} / ${med.presentation}`;
        const placeholderUrl = `https://placehold.co/600x300/e0f2fe/083344?text=${encodeURIComponent(imgText)}`;
        const profile = state.ui.patientProfile;
    
        selectors.modalContent.innerHTML = `
            <div class="p-6 border-b flex justify-between items-start">
                <div><h2 id="modalTitle" class="text-2xl font-bold text-slate-800">${med.name}</h2><p class="text-slate-600">${med.presentation}</p></div>
                <button id="modalFavButton" class="text-3xl ${isFavorite ? 'is-favorite' : 'text-slate-300'}" aria-label="Añadir a favoritos">★</button>
            </div>
            <div class="p-6 overflow-y-auto">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-slate-700">
                    <div class="md:col-span-2"><img src="${med.imageUrl || placeholderUrl}" alt="Imagen de ${med.name}" class="w-full h-48 object-cover rounded-lg mb-4" onerror="this.src='${placeholderUrl}'"></div>
                    <div class="md:col-span-2 info-box-success"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg><p><strong>Indicaciones:</strong> ${med.indications || 'No especificadas'}</p></div>
                    <div class="md:col-span-2 info-box-danger"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" /></svg><p><strong>Contraindicaciones:</strong> ${med.contraindications || 'No especificadas'}</p></div>
                    ${med.warnings ? `<div class="md:col-span-2 info-box-warning ${profile.has('renal') && med.renalDoseAdjust?.enabled ? 'info-box-highlight' : ''}"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.21 3.03-1.742 3.03H4.42c-1.532 0-2.492-1.696-1.742-3.03l5.58-9.92zM10 13a1 1 0 110-2 1 1 0 010 2zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" /></svg><p><strong>Advertencias:</strong> ${med.warnings}</p></div>` : ''}
                    ${med.notes ? `<div class="md:col-span-2 info-box-info"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" /></svg><p><strong>Notas:</strong> ${med.notes}</p></div>` : ''}
                    <div class="md:col-span-2 grid grid-cols-1 sm:grid-cols-3 gap-2 text-center mt-4">
                        <div class="info-box-age"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mx-auto mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg><span class="font-bold">Edad Mínima</span><span>${med.minimumAge || '?'}</span></div>
                        <div class="info-box-pregnancy ${profile.has('pregnancy') ? 'info-box-highlight' : ''}"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mx-auto mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg><span class="font-bold">Embarazo</span><span>${med.pregnancy || 'N/A'}</span></div>
                        <div class="info-box-lactation ${profile.has('lactation') ? 'info-box-highlight' : ''}"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mx-auto mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" /></svg><span class="font-bold">Lactancia</span><span>${med.lactation || 'N/A'}</span></div>
                    </div>
                    <div><strong>Familia:</strong><p>${med.family || 'N/A'}</p></div><div><strong>Usos:</strong><p>${med.uses || 'N/A'}</p></div><div><strong>Dosis Adulto:</strong><p>${med.dose_adult || 'N/A'}</p></div><div><strong>Dosis Pediátrica:</strong><p>${med.dose_pediatric || 'No especificada'}</p></div>
                    ${med.isCalculable ? `<div class="md:col-span-2 mt-4"><div class="calculator-card"><div class="calculator-header"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M12 21a9 9 0 110-18 9 9 0 010 18z" /></svg><h4 class="font-bold">Calculadora de Dosis Pediátrica</h4></div><div class="calculator-body"><input type="number" id="patientWeight" placeholder="Peso del paciente en kg" class="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500"><button id="calculateDoseBtn" class="w-full px-4 py-2 bg-blue-600 text-white font-semibold rounded-md hover:bg-blue-700 transition-colors">Calcular Dosis</button></div><div id="doseResult" class="calculator-result"></div></div></div>` : ''}
                </div>
            </div>
            <div class="p-4 bg-slate-50 border-t flex justify-end"><button id="closeModalBtn" class="px-4 py-2 bg-slate-200 rounded-md hover:bg-slate-300 transition-colors">Cerrar</button></div>
        `;
        selectors.modal.classList.remove('hidden'); document.body.style.overflow = 'hidden';
        selectors.modalContent.focus();
        document.getElementById('closeModalBtn').addEventListener('click', closeModal);
        document.getElementById('modalFavButton').addEventListener('click', (e) => toggleFavorite(med.originalIndex, e.currentTarget));
        if (med.isCalculable) setupDoseCalculator(med);
    }
    
    function setupDoseCalculator(med) {
        const calculateBtn = document.getElementById('calculateDoseBtn');
        const weightInput = document.getElementById('patientWeight');
        const resultDiv = document.getElementById('doseResult');
        calculateBtn.addEventListener('click', () => {
            const weight = parseFloat(weightInput.value);
            if (isNaN(weight) || weight <= 0) { resultDiv.innerHTML = '<p class="text-red-600">Por favor, ingrese un peso válido.</p>'; return; }
            const unit = med.isDrops ? 'gotas' : 'ml';
            const dropsPerMl = med.name.includes("Paracetamol") ? 30 : 20;
            let doseRange, frequency;
            if (med.doseMin_mg_kg_dosis) {
                const minDoseUnit = (weight * med.doseMin_mg_kg_dosis / med.concentration) * (med.isDrops ? dropsPerMl : 1);
                const maxDoseUnit = (weight * med.doseMax_mg_kg_dosis / med.concentration) * (med.isDrops ? dropsPerMl : 1);
                doseRange = `${minDoseUnit.toFixed(1)} - ${maxDoseUnit.toFixed(1)} ${unit}`;
                frequency = `cada ${Math.round(24 / med.doseFreq)} horas`;
            } else {
                const intervals = med.doseIntervals.split('-').map(Number);
                const avgIntervals = (intervals[0] + (intervals[1] || intervals[0])) / 2;
                const minDoseUnit = (weight * med.doseMin_mg_kg_dia / avgIntervals / med.concentration) * (med.isDrops ? dropsPerMl : 1);
                const maxDoseUnit = (weight * med.doseMax_mg_kg_dia / avgIntervals / med.concentration) * (med.isDrops ? dropsPerMl : 1);
                doseRange = `${minDoseUnit.toFixed(1)} - ${maxDoseUnit.toFixed(1)} ${unit}`;
                frequency = `cada ${Math.round(24 / avgIntervals)} horas`;
            }
            const durationText = med.duration || '';
            const copyText = `Dar ${doseRange.replace(' - ', ' a ')} vía oral ${frequency} ${durationText}.`;
            resultDiv.innerHTML = `
                <div class="result-item"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v2a2 2 0 01-2 2H7a2 2 0 01-2-2V4z" /><path d="M5 12a2 2 0 012-2h6a2 2 0 012 2v2a2 2 0 01-2 2H7a2 2 0 01-2-2v-2z" /></svg><span><strong>Dosis:</strong> ${doseRange}</span></div>
                <div class="result-item"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd" /></svg><span><strong>Frecuencia:</strong> ${frequency}</span></div>
                ${durationText ? `<div class="result-item"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" /></svg><span><strong>Duración:</strong> ${durationText}</span></div>` : ''}
                <button id="copyDoseBtn" class="copy-btn"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" /><path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" /></svg>Copiar Indicación</button>`;
            document.getElementById('copyDoseBtn').addEventListener('click', () => { navigator.clipboard.writeText(copyText).then(() => showToast('¡Indicación copiada!')); });
        });
    }

    function closeModal() { selectors.modal.classList.add('hidden'); document.body.style.overflow = 'auto'; }

    // --- CONFIGURACIÓN INICIAL DE FILTROS Y EVENTOS ---
    function populateFilters() {
        const families = ['Todos', ...state.medications.uniqueFamilies];
        selectors.familyFilterContainer.innerHTML = families.map(f => `<button class="filter-btn ${f === 'Todos' ? 'active' : ''}" data-family="${f}">${f}</button>`).join('');
        selectors.themesFilterContainer.innerHTML = Object.entries(clinicalThemes).map(([id, t]) => `<button class="theme-btn" data-theme-id="${id}">${t.name}</button>`).join('');
    }

    function addFilterEventListeners() {
        selectors.familyFilterContainer.addEventListener('click', (e) => {
            const btn = e.target.closest('.filter-btn');
            if (!btn) return;
            selectors.familyFilterContainer.querySelector('.active')?.classList.remove('active');
            btn.classList.add('active');
            state.ui.activeFamily = btn.dataset.family;
            selectors.familiesBtnText.textContent = btn.dataset.family;
            setView('medications');
            closeAllDropdowns();
        });
        selectors.themesFilterContainer.addEventListener('click', (e) => {
            const btn = e.target.closest('.theme-btn');
            if (!btn) return;
            setView('themes', btn.dataset.themeId);
            closeAllDropdowns();
        });
    }
    
    function closeAllDropdowns() {
        document.querySelectorAll('.dropdown-panel.is-open').forEach(panel => panel.classList.remove('is-open'));
        document.querySelectorAll('.dropdown-btn.active').forEach(btn => {
            if(btn.id !== "favorites-btn" && btn.id !== "interaction-checker-btn") {
                btn.classList.remove('active');
                btn.setAttribute('aria-expanded', 'false');
            }
        });
    }

    function setupAdvancedFilters() {
        const panel = selectors.advancedFilterPanel;
        const filters = {
            'Familias': { type: 'checkbox', options: state.medications.uniqueFamilies, key: 'families' },
            'Presentaciones': { type: 'checkbox', options: state.medications.uniquePresentations, key: 'presentations' },
            'Condiciones': { type: 'checkbox', options: { 'Ajuste Renal Requerido': 'renalDoseAdjust', 'Seguro en Embarazo': 'pregnancySafe', 'Seguro en Lactancia': 'lactationSafe' }, key: 'conditions' }
        };
        let html = '<div class="col-span-full flex justify-between items-center"><h3 class="text-xl font-bold">Filtros Avanzados</h3><button id="clear-adv-filters" class="clear-selection-btn">Limpiar Filtros</button></div>';
        for (const [title, config] of Object.entries(filters)) {
            html += `<div class="adv-filter-group"><h4>${title}</h4>`;
            if (config.key === 'conditions') {
                for (const [label, value] of Object.entries(config.options)) { html += `<label><input type="checkbox" data-key="${value}" data-group="conditions">${label}</label>`; }
            } else {
                 for (const option of config.options) { html += `<label><input type="checkbox" value="${option}" data-group="${config.key}">${option}</label>`; }
            }
            html += `</div>`;
        }
        panel.innerHTML = html;
        panel.addEventListener('change', handleAdvancedFilterChange);
        document.getElementById('clear-adv-filters').addEventListener('click', clearAdvancedFilters);
    }

    function handleAdvancedFilterChange() {
        state.ui.advancedFilters = {};
        const activeFilters = selectors.advancedFilterPanel.querySelectorAll('input:checked');
        activeFilters.forEach(input => {
            const group = input.dataset.group;
            const key = input.dataset.key || group;
            const value = input.value || 'true';
            
            if (!state.ui.advancedFilters[key]) state.ui.advancedFilters[key] = [];
            state.ui.advancedFilters[key].push(value);
        });
        const count = activeFilters.length;
        selectors.advancedFilterCount.textContent = count;
        selectors.advancedFilterCount.classList.toggle('hidden', count === 0);
        state.ui.searchTerm = '';
        selectors.searchBar.value = '';
        setView('medications');
    }

    function clearAdvancedFilters() {
        selectors.advancedFilterPanel.querySelectorAll('input:checked').forEach(input => input.checked = false);
        handleAdvancedFilterChange();
    }

    function setupPatientProfile() {
        const profiles = { 'Embarazo': 'pregnancy', 'Lactancia': 'lactation', 'Insuf. Renal': 'renal' };
        selectors.patientProfileControls.innerHTML = Object.entries(profiles)
            .map(([label, key]) => `<button class="profile-btn" data-profile="${key}">${label}</button>`).join('');
        selectors.patientProfileControls.addEventListener('click', (e) => {
            const btn = e.target.closest('.profile-btn');
            if (!btn) return;
            const profile = btn.dataset.profile;
            btn.classList.toggle('active');
            if (state.ui.patientProfile.has(profile)) state.ui.patientProfile.delete(profile);
            else state.ui.patientProfile.add(profile);
            updateDisplay();
        });
    }

    function setupEventListeners() {
        selectors.searchBar.addEventListener('input', debounce((e) => {
            state.ui.searchTerm = e.target.value;
            clearAdvancedFilters();
            if (state.ui.view !== 'medications') setView('medications');
            else updateDisplay();
        }));
        selectors.searchBar.addEventListener('change', (e) => {
            const term = e.target.value.trim().toLowerCase();
            if (term && !state.searchHistory.includes(term)) { state.searchHistory.unshift(term); if (state.searchHistory.length > 15) state.searchHistory.pop(); saveSearchHistory(); }
        });
        selectors.favoritesBtn.addEventListener('click', () => setView('favorites'));
        selectors.interactionCheckerBtn.addEventListener('click', () => setView('interaction-checker'));
        const toggleDropdown = (btn, panel) => {
            const isOpen = panel.classList.toggle('is-open');
            btn.classList.toggle('active', isOpen);
            btn.setAttribute('aria-expanded', isOpen);
        }
        selectors.familiesDropdownBtn.addEventListener('click', (e) => { e.stopPropagation(); toggleDropdown(e.currentTarget, selectors.familiesDropdownPanel); });
        selectors.themesDropdownBtn.addEventListener('click', (e) => { e.stopPropagation(); toggleDropdown(e.currentTarget, selectors.themesDropdownPanel); });
        selectors.advancedFilterBtn.addEventListener('click', () => selectors.advancedFilterPanel.classList.toggle('hidden'));
        document.addEventListener('click', () => closeAllDropdowns());
        document.addEventListener('keydown', (e) => { if (e.key === "Escape" && !selectors.modal.classList.contains('hidden')) closeModal(); });
        selectors.modal.addEventListener('click', (e) => { if (e.target.id === 'medicationModal') closeModal(); });
        document.getElementById('modoAlfredoToggle').addEventListener('click', () => document.body.classList.toggle('dark'));
    }

    // --- FUNCIÓN DE INICIO DE LA APLICACIÓN ---
    function initializeApp() {
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./service-worker.js').catch(err => console.error('SW reg failed:', err));
        }
        
        loadStateFromStorage();
        setupEventListeners();
        
        try {
            const data = medicationData;
            
            const uniqueMeds = Array.from(new Map(data.map(med => [med.name + med.presentation, med])).values());
            state.medications.all = uniqueMeds.map((med, index) => ({...med, originalIndex: index}))
                                             .sort((a,b) => a.name.localeCompare(b.name));
            
            state.medications.uniqueFamilies = [...new Set(state.medications.all.map(m => m.simpleFamily).filter(Boolean))].sort();
            const presentations = new Set();
            state.medications.all.forEach(m => {
                const p = normalizeText(m.presentation);
                if (p.includes('tableta') || p.includes('cápsula') || p.includes('perlas') || p.includes('grageas') || p.includes('comprimido')) presentations.add('Tabletas/Cápsulas');
                else if (p.includes('jarabe') || p.includes('suspensi') || p.includes('gotas') || p.includes('soluci')) presentations.add('Líquidos Orales');
                else if (p.includes('inyectable')) presentations.add('Inyectables');
                else if (p.includes('crema') || p.includes('gel') || p.includes('ungüento')) presentations.add('Tópicos');
                else if (p.includes('óvulo') || p.includes('supositorio')) presentations.add('Supositorios/Óvulos');
                else if (p.includes('inhalador') || p.includes('nebulizar') || p.includes('nasal')) presentations.add('Inhalados/Nasales');
            });
            state.medications.uniquePresentations = [...presentations].sort();

            selectors.medCount.textContent = state.medications.all.length;
            
            populateFilters();
            addFilterEventListeners();
            setupAdvancedFilters();
            setupPatientProfile();
            
            updateDisplay();

        } catch (error) {
            console.error('Error al inicializar la app:', error);
            selectors.skeletonLoader.innerHTML = '<p class="text-red-500 col-span-full text-center">No se pudieron cargar los medicamentos. Revisa la consola para más detalles.</p>';
        }
    }

    initializeApp();
});
</script>
</body>
</html>
